<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>1590å¹´ã”ã‚ã®æ—§åˆ©æ ¹å·æ°´ç³»ï¼ˆåºƒåŸŸï¼‰ï¼‹çŸ³ç”°å ¤ï¼‹å¿å·ãƒ»æ˜Ÿå·ï¼‹æ­¦è”µæ°´è·¯ãƒ»è¦‹æ²¼ä»£ç”¨æ°´ï¼ˆv18ï¼šç¾è’å·ã®å²©æ·µä»¥å—ã‚«ãƒƒãƒˆï¼ä¸‰ã‚±å°»ç›´ç·šå‰Šé™¤ï¼å·¦ãƒ‘ãƒãƒ«æ•´ç†ï¼‰</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<style>
  html, body { height: 100%; margin: 0; }
  #map { height: 100%; width: 100%; }
  .panel {
    position: absolute;
    top: 10px; left: 10px;
    z-index: 1000;
    background: rgba(255,255,255,0.92);
    padding: 10px 12px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    max-width: 380px;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
    line-height: 1.35;
  }
  .panel h1 { font-size: 14px; margin: 0 0 6px 0; }
  .panel .small { font-size: 12px; color: #333; }
  .panel .small ul { margin: 6px 0 0 18px; padding: 0; }
  .panel .small li { margin: 4px 0; }
  .panel .status { font-size: 12px; margin-top: 6px; }
  .legend { margin-top: 8px; font-size: 12px; }
  .legend-row { display: flex; align-items: center; margin: 4px 0; gap: 8px; }
  .swatch { width: 38px; height: 0; border-top: 5px solid #000; border-radius: 2px; }
  .swatch.thin { border-top-width: 3px; opacity: 0.9; }
  .swatch.dashed { border-top-style: dashed; }
  .btnrow { margin-top: 8px; display: flex; gap: 6px; flex-wrap: wrap; }
  button {
    border: 1px solid #bbb; background: #fff; border-radius: 10px;
    padding: 6px 10px; font-size: 12px; cursor: pointer;
  }
  button:hover { background: #f4f4f4; }
  .sliderrow { margin-top: 8px; font-size: 12px; }
  input[type="range"] { width: 100%; }

  /* Key site pins (no external marker images) */
  .pin {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transform: translate(0, -6px);
  }
  .pin-dot {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    border: 2px solid #ffffff;
    box-shadow: 0 0 0 2px rgba(0,0,0,0.45), 0 2px 6px rgba(0,0,0,0.25);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    line-height: 1;
    user-select: none;
  }
  .pin-text {
    background: rgba(255,255,255,0.92);
    border: 1px solid rgba(0,0,0,0.20);
    border-radius: 6px;
    padding: 2px 7px;
    font-size: 13px;
    white-space: nowrap;
    box-shadow: 0 1px 2px rgba(0,0,0,0.18);
  }
</style>
</head>
<body>
<div id="map"></div>

<div class="panel">
  <h1>1590å¹´ã”ã‚ã®æ—§åˆ©æ ¹å·æ°´ç³»ï¼ˆåºƒåŸŸï¼‰ï¼‹çŸ³ç”°å ¤ï¼‹å¿å·ãƒ»æ˜Ÿå·ï¼ˆv18ï¼‰</h1>
  <div class="small">
    <ul>
      <li><b>å¤ªã„ç·š</b>ï¼š1590å¹´å‰å¾Œï¼ˆæ±é·ãƒ»è¥¿é·ã®å¤§æ”¹ä¿®å‰ï¼‰ã«ã€Œæœ¬æµç­‹/ä¸»è¦ãªæµã‚Œç­‹ã€ã¨ã—ã¦èªã‚‰ã‚Œã‚‹æ®‹å­˜æ²³é“ï¼ˆå¤åˆ©æ ¹å·ãƒ»å¤§è½å¤åˆ©æ ¹å·ï¼å…ƒè’å·ï¼ä¸­å·ãƒ»ç¶¾ç€¬å·ï¼‰</li>
      <li><b>ä¸‹æµå£ã®å‚ç…§</b>ï¼šæµ…è‰å·/éš…ç”°å·ç­‹ï¼ˆèª¬æ˜ã«å‡ºã¦ãã‚‹ã€Œæ±äº¬æ¹¾ã¸ã®å‡ºå£å´ã€ã®ç›®å®‰ï¼‰</li>
      <li><b>ï¼ˆå‚ç…§ï¼‰ç¾è’å·ã®è©²å½“åŒºé–“</b>ï¼šå’Œç”°å‰é‡å·ï¼ˆæœ€ä¸‹æµå´ï¼‰â†’å…¥é–“å·åˆæµâ†’éš…ç”°å·æœ€ä¸Šæµï¼ˆå²©æ·µä»˜è¿‘ï¼‰ã¾ã§ã‚’ã€ç¾æ²³é“ãƒ‡ãƒ¼ã‚¿ã§â€œã¤ãªãã®ç›®å®‰â€ã¨ã—ã¦è¡¨ç¤ºã€‚â€»å²©æ·µä»¥å—ï¼ˆç¾ãƒ»è’å·ã®æ”¾æ°´è·¯åŒºé–“ã€œæ²³å£ï¼‰ã¯1590è¡¨ç¤ºã§ã¯æãã¾ã›ã‚“ã€‚</li>
      <li><b>èŒ¶ã®ç ´ç·š</b>ï¼šã€è¥¿é·å‰ã€‘å…¥é–“å·æ°´ç³»ãƒ«ãƒ¼ãƒˆï¼ˆæ¨å®šï¼‰ï¼ˆå’Œç”°â†’å¸‚é‡â†’å…¥é–“â†’éš…ç”°å·ç­‹ï¼‰ã€‚â€»ç§©çˆ¶ä»˜è¿‘ã®ä¸Šæµå±±åœ°ã¯æ—§è’å·æ°´ç³»ã¨æ··åŒã—ã‚„ã™ã„ã®ã§ã€æ¨å®šãƒ«ãƒ¼ãƒˆã¯<b>å¹³é‡éƒ¨ã®æ¥ç¶šåŒºé–“ã®ã¿</b>è¡¨ç¤ºã€‚</li>
      <li><b>é»’ã®ç ´ç·š</b>ï¼šçŸ³ç”°å ¤ï¼ˆæ¨å®šï¼‰ï¼ˆå›½äº¤çœã®æ¨å®šå›³ã®åœ°åã‚¢ãƒ³ã‚«ãƒ¼ã‚’æ‰‹ãŒã‹ã‚Šã«æ¦‚ç•¥ã§ãªãã‚Šï¼‰</li>
      <li><b>ã‚·ã‚¢ãƒ³</b>ï¼šæ­¦è”µæ°´è·¯ï¼ˆ1960å¹´ä»£ãƒ»å‚è€ƒï¼‰ï¼<b>é»„</b>ï¼šè¦‹æ²¼ä»£ç”¨æ°´ï¼ˆ1728å¹´ãƒ»å‚è€ƒï¼‰</li>
      <li>â€»<b>æ˜Ÿå·Ã—è¦‹æ²¼ä»£ç”¨æ°´ã®å…±ç”¨åŒºé–“</b>ã¯ã€<b>æ˜Ÿå·ã®ã¿ONâ†’æ˜Ÿå·è‰²</b>ï¼<b>è¦‹æ²¼ã®ã¿ONâ†’è¦‹æ²¼è‰²</b>ï¼<b>ä¸¡æ–¹ONâ†’äºŒè‰²</b>ã§è¡¨ç¤ºã—ã¾ã™ã€‚</li>
      <li>èƒŒæ™¯ã«<b>æ²»æ°´åœ°å½¢åˆ†é¡å›³</b>ï¼ˆæ—§æ²³é“ãƒ»è‡ªç„¶å ¤é˜²ãƒ»å¾ŒèƒŒæ¹¿åœ°ï¼‰ã‚’é‡ã­ã‚‰ã‚Œã¾ã™ã€‚</li>
    </ul>
    <div style="margin-top:6px;">
      â€»æ²³å·ç·šãƒ‡ãƒ¼ã‚¿ã¯ <b>./data/rivers_wide_overpass.json</b> ãŒã‚ã‚Œã°ãã‚Œã‚’å„ªå…ˆã—ã¦èª­ã¿è¾¼ã¿ã€ç„¡ã‘ã‚Œã° Overpassï¼ˆOSMï¼‰ã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚
    </div>
  </div>

  <div class="btnrow">
    <button id="btnReload">æ²³å·ç·šãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿</button>
    <button id="btnReset">è¡¨ç¤ºç¯„å›²ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    <button id="btnPreset">1590ï¼ˆæ—¢å®šã«æˆ»ã™ï¼‰</button>
    <button id="btnJumpIshida">çŸ³ç”°å ¤ä»˜è¿‘ã¸</button>
  </div>

  <div class="sliderrow">
    æ²»æ°´åœ°å½¢åˆ†é¡å›³ã®é€éåº¦ï¼š<span id="opval">0.55</span><br/>
    <input id="opacity" type="range" min="0" max="0.9" step="0.05" value="0.55"/>
  </div>

  <div class="legend">
    <div class="legend-row"><span class="swatch" style="border-top-color:#0072B2"></span>
      æ—§åˆ©æ ¹å·ï¼ˆå¤åˆ©æ ¹/å¤§è½ï¼‰ãƒ»å…ƒè’å·ãƒ»ä¸­å·/ç¶¾ç€¬ãƒ»å¿å·ãƒ»æ˜Ÿå·ï¼ˆåŒä¸€æ°´ç³»ã¨ã—ã¦åŒè‰²ï¼‰</div>
    <div class="legend-row"><span class="swatch thin dashed" style="border-top-color:#0072B2"></span>
      å¿å·ä¸Šæµï¼ˆç†Šè°·ä¸­å¿ƒéƒ¨ã§ã€Œæ˜Ÿå·ã€ã¨å‘¼ã°ã‚Œã‚‹åŒºé–“ï¼‰ã¯ç ´ç·š</div>
    <div class="legend-row"><span class="swatch" style="border-top-color:#8c510a"></span>
      ä¸‹æµå£å‚ç…§ï¼ˆæµ…è‰/éš…ç”°ï¼‰ãƒ»å…¥é–“å·ãƒ»ï¼ˆç¾è’å·ã®è©²å½“åŒºé–“ï¼‰</div>
    <div class="legend-row"><span class="swatch thin dashed" style="border-top-color:#8c510a"></span>
      ã€è¥¿é·å‰ã€‘å…¥é–“å·æ°´ç³»ãƒ«ãƒ¼ãƒˆï¼ˆæ¨å®šï¼šå’Œç”°â†’å¸‚é‡â†’å…¥é–“â†’éš…ç”°ç­‹ï¼‰</div>
    <div class="legend-row"><span class="swatch dashed" style="border-top-color:#000000"></span>
      çŸ³ç”°å ¤ï¼ˆæ¨å®šï¼‰</div>
    <div class="legend-row"><span class="swatch dashed" style="border-top-color:#00bcd4"></span>
      æ­¦è”µæ°´è·¯ï¼ˆ1960å¹´ä»£ãƒ»å‚è€ƒï¼‰</div>
    <div class="legend-row"><span class="swatch dashed" style="border-top-color:#e6ab02"></span>
      è¦‹æ²¼ä»£ç”¨æ°´ï¼ˆ1728å¹´ãƒ»å‚è€ƒï¼‰</div>
    <div class="legend-row"><span class="swatch thin" style="border-top-color:#0072B2"></span><span class="swatch thin" style="border-top-color:#e6ab02"></span>
      å…±ç”¨åŒºé–“ï¼ˆæ˜Ÿå·Ã—è¦‹æ²¼ä»£ç”¨æ°´ï¼‰ï¼šä¸¡æ–¹ONã§äºŒè‰²</div>
    <div class="legend-row">ğŸ“ <b>é‡è¦åœ°ç‚¹</b>ï¼šå¿åŸï¼çŸ³ç”°ä¸‰æˆæœ¬é™£ï¼ˆä¸¸å¢“å±±å¤å¢³ï¼‰</div>
  </div>

  <div class="status" id="status">æº–å‚™ä¸­â€¦</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
  // ----- Map setup -----
  const map = L.map('map', { preferCanvas: true });

  const paneRivers = map.createPane('paneRivers'); paneRivers.style.zIndex = 450;
  const paneLocal  = map.createPane('paneLocal');  paneLocal.style.zIndex  = 460;
  const paneIshida = map.createPane('paneIshida'); paneIshida.style.zIndex = 470;

  const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap contributors'
  });
  const gsiStd = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
    maxZoom: 18, attribution: '&copy; GSI Japan'
  });
  const gsiRelief = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/relief/{z}/{x}/{y}.png', {
    maxZoom: 15, attribution: '&copy; GSI Japan'
  });

  const lcmfc2 = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/lcmfc2/{z}/{x}/{y}.png', {
    maxZoom: 16, opacity: 0.55, attribution: '&copy; GSI Japan'
  });
  const hillshade = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/hillshademap/{z}/{x}/{y}.png', {
    maxZoom: 16, opacity: 0.35, attribution: '&copy; GSI Japan'
  });

  osm.addTo(map);
  // è¦æœ›: åœ°å½¢ãƒ¬ã‚¤ãƒ¤ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆON
  lcmfc2.addTo(map);
  hillshade.addTo(map);

  const baseLayers = {
    "OpenStreetMap": osm,
    "åœ°ç†é™¢ æ¨™æº–åœ°å›³": gsiStd,
    "åœ°ç†é™¢ è‰²åˆ¥æ¨™é«˜å›³": gsiRelief
  };

  // ----- Colors -----
  const COLOR_MAIN  = "#0072B2"; // åŒä¸€æ°´ç³»ï¼ˆå¤åˆ©æ ¹/å…ƒè’å·/ä¸­å·/ç¶¾ç€¬/å¿å·/æ˜Ÿå·ï¼‰
  const COLOR_EXIT  = "#8c510a"; // å…¥é–“æ°´ç³»ï¼‹å‡ºå£å‚ç…§ï¼ˆéš…ç”°ç­‹ãªã©ï¼‰
  const COLOR_ISHIDA = "#000000";

  // ----- Layer groups (visible) -----
  const lyrKofurone    = L.layerGroup();
  const lyrMotoArakawa = L.layerGroup();
  const lyrNakaAyase   = L.layerGroup();

  const lyrOshikawa    = L.layerGroup(); // å¿å·ï¼‹å¿å·ä¸Šæµï¼ˆç†Šè°·ä¸­å¿ƒéƒ¨=æ˜Ÿå·ï¼‰ã‚’çµ±åˆ
  const lyrHoshikawa   = L.layerGroup(); // æ˜Ÿå·ï¼ˆå…ƒè’å·æ”¯æµï¼‰

  const lyrSumida      = L.layerGroup(); // å‡ºå£å‚ç…§ï¼ˆæµ…è‰/éš…ç”°ï¼‰
  const lyrIruma       = L.layerGroup(); // å…¥é–“å·ï¼ˆå‚ç…§ï¼‰
  const lyrArakawaLink = L.layerGroup(); // ç¾ãƒ»è’å·ã®ã†ã¡ï¼ˆå’Œç”°ä¸‹æµâ†’å…¥é–“åˆæµâ†’éš…ç”°ä¸Šæµï¼‰ç›¸å½“éƒ¨
  const lyrIrumaPreRoute = L.layerGroup(); // è¥¿é·å‰ï¼šå…¥é–“æ°´ç³»ãƒ«ãƒ¼ãƒˆï¼ˆæ¨å®šï¼‰

  const lyrKeySites    = L.layerGroup();
  const lyrIshidaEst   = L.layerGroup();

  const lyrMusashiSuido   = L.layerGroup();
  const lyrMinumaDaiyosui = L.layerGroup();

  // ----- Layer groups (internal / raw, not exposed) -----
  const lyrArakawaRaw = L.layerGroup();
  const lyrIrumaRaw   = L.layerGroup();
  const lyrWadaRaw    = L.layerGroup();
  const lyrIchinoRaw  = L.layerGroup();

  // Shared segments: æ˜Ÿå· Ã— è¦‹æ²¼ä»£ç”¨æ°´ï¼ˆåŒä¸€æ²³é“ã‚’å…±ç”¨ã™ã‚‹åŒºé–“ï¼‰
  const lyrSharedHM_H      = L.layerGroup();
  const lyrSharedHM_M      = L.layerGroup();
  const lyrSharedHM_Stripe = L.layerGroup();

  // ----- Overlay list (right panel) -----
  const overlayLayers = {
    "åœ°å½¢ï½œæ²»æ°´åœ°å½¢åˆ†é¡å›³ï¼ˆæ›´æ–°ç‰ˆï¼‰": lcmfc2,
    "åœ°å½¢ï½œé™°å½±èµ·ä¼å›³": hillshade,

    "1590ï½œæ—§åˆ©æ ¹å·ï¼ˆå¤åˆ©æ ¹/å¤§è½ï¼‰": lyrKofurone,
    "1590ï½œæ—§è’å·ï¼ˆå…ƒè’å·ï¼‰": lyrMotoArakawa,
    "1590ï½œæ—§åˆ©æ ¹å·æœ¬æµï¼ˆä¸­å·ãƒ»ç¶¾ç€¬ï¼‰": lyrNakaAyase,
    "1590ï½œå¿å·ï¼ˆç†Šè°·ä¸­å¿ƒéƒ¨=æ˜Ÿå·å«ã‚€ï¼‰": lyrOshikawa,
    "1590ï½œæ˜Ÿå·ï¼ˆå…ƒè’å·æ”¯æµï¼‰": lyrHoshikawa,

    "1590ï½œå…¥é–“å·ï¼ˆå‚ç…§ï¼‰": lyrIruma,
    "1590ï½œç¾è’å·ï¼ˆè©²å½“åŒºé–“ï¼šå’Œç”°ä¸‹æµâ†’å…¥é–“åˆæµâ†’éš…ç”°ä¸Šæµï¼‰": lyrArakawaLink,
    "1590ï½œå‡ºå£å‚ç…§ï¼ˆæµ…è‰/éš…ç”°ï¼‰": lyrSumida,
    "1590ï½œå…¥é–“æ°´ç³»ãƒ«ãƒ¼ãƒˆï¼ˆæ¨å®šï¼‰": lyrIrumaPreRoute,

    "1590ï½œé‡è¦åœ°ç‚¹ï¼ˆå¿åŸãƒ»æœ¬é™£ï¼‰": lyrKeySites,
    "1590ï½œçŸ³ç”°å ¤ï¼ˆæ¨å®šï¼‰": lyrIshidaEst,

    "å‚è€ƒï½œæ­¦è”µæ°´è·¯ï¼ˆ1960å¹´ä»£ï¼‰": lyrMusashiSuido,
    "å‚è€ƒï½œè¦‹æ²¼ä»£ç”¨æ°´ï¼ˆ1728ï¼‰": lyrMinumaDaiyosui
  };

  // è¦æœ›: å³ãƒ‘ãƒãƒ«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§é–‰ã˜ãªã„
  L.control.layers(baseLayers, overlayLayers, { collapsed: false }).addTo(map);

  const initialBounds = L.latLngBounds(
    L.latLng(35.55, 139.20),
    L.latLng(36.45, 140.05)
  );
  map.fitBounds(initialBounds);

  const statusEl = document.getElementById('status');

  // ----- UI wiring -----
  const opSlider = document.getElementById('opacity');
  const opVal = document.getElementById('opval');
  opSlider.addEventListener('input', () => {
    const v = parseFloat(opSlider.value);
    opVal.textContent = v.toFixed(2);
    lcmfc2.setOpacity(v);
  });

  document.getElementById('btnReset').addEventListener('click', () => map.fitBounds(initialBounds));
  document.getElementById('btnReload').addEventListener('click', () => loadRiversWide());
  document.getElementById('btnPreset').addEventListener('click', () => applyDefaultLayers());
  document.getElementById('btnJumpIshida').addEventListener('click', () => {
    // çŸ³ç”°å ¤ï¼‹å¿åŸå‘¨è¾ºï¼ˆè¡Œç”°ï¼‰
    map.setView([36.130, 139.463], 13);
  });

  function setLayerOnOff(layer, on) {
    if (on) { if (!map.hasLayer(layer)) map.addLayer(layer); }
    else { if (map.hasLayer(layer)) map.removeLayer(layer); }
  }

  function applyDefaultLayers() {
    // åœ°å½¢ãƒ¬ã‚¤ãƒ¤ï¼ˆè¦æœ›: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆONï¼‰
    setLayerOnOff(lcmfc2, true);
    setLayerOnOff(hillshade, true);

    // 1590ï¼ˆæ°´ç³»A: åŒè‰²ãƒ»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆONï¼‰
    [lyrKofurone, lyrMotoArakawa, lyrNakaAyase, lyrOshikawa, lyrHoshikawa].forEach(l => setLayerOnOff(l, true));

    // 1590ï¼ˆæ°´ç³»B: åŒè‰²ãƒ»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆONï¼‰
    [lyrIruma, lyrArakawaLink, lyrSumida, lyrIrumaPreRoute].forEach(l => setLayerOnOff(l, true));

    // é‡è¦åœ°ç‚¹ãƒ»çŸ³ç”°å ¤
    [lyrKeySites, lyrIshidaEst].forEach(l => setLayerOnOff(l, true));

    // å‚è€ƒã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆOFF
    [lyrMusashiSuido, lyrMinumaDaiyosui].forEach(l => setLayerOnOff(l, false));

    updateSharedHMVisibility();
  }

  // ----- Geometry helpers -----
  function flattenLatLngs(latlngs) {
    const out = [];
    (function rec(x) {
      if (!x) return;
      if (Array.isArray(x)) { x.forEach(rec); return; }
      if (typeof x.lat === "number" && typeof x.lng === "number") out.push(x);
    })(latlngs);
    return out;
  }

  function corePolylines(layerGroup) {
    return layerGroup.getLayers().filter(l => {
      if (!(l instanceof L.Polyline)) return false;
      const c = (l.options && l.options.color) ? l.options.color : "";
      // addPolylineWithOutline ã®ãƒãƒ­ãƒ¼ï¼ˆç™½/é»’ï¼‰ã‚’é™¤å¤–
      if (c === "#ffffff" || c === "#000000") return false;
      return true;
    });
  }

  function approxDistKm(a, b) {
    const R = 6371; // km
    const toRad = (d) => d * Math.PI / 180;
    const dLat = toRad(b.lat - a.lat);
    const dLng = toRad(b.lng - a.lng);
    const lat1 = toRad(a.lat);
    const lat2 = toRad(b.lat);
    const sinDLat = Math.sin(dLat/2);
    const sinDLng = Math.sin(dLng/2);
    const h = sinDLat*sinDLat + Math.cos(lat1)*Math.cos(lat2)*sinDLng*sinDLng;
    return 2 * R * Math.asin(Math.min(1, Math.sqrt(h)));
  }

  function samplePointsFromPolyline(pl, maxPoints) {
    const pts = flattenLatLngs(pl.getLatLngs());
    if (pts.length <= maxPoints) return pts;
    const step = Math.ceil(pts.length / maxPoints);
    const out = [];
    for (let i = 0; i < pts.length; i += step) out.push(pts[i]);
    return out;
  }

  function nearestBetweenGroups(groupA, groupB, filterA, filterB) {
    const polysA = corePolylines(groupA).filter(pl => !filterA || filterA(pl));
    const polysB = corePolylines(groupB).filter(pl => !filterB || filterB(pl));
    if (polysA.length === 0 || polysB.length === 0) return null;

    const bPts = [];
    polysB.forEach(pl => bPts.push(...samplePointsFromPolyline(pl, 80)));

    let best = { d2: Infinity, a: null, b: null };
    polysA.forEach(pl => {
      const aPts = samplePointsFromPolyline(pl, 80);
      aPts.forEach(pa => {
        for (let i = 0; i < bPts.length; i++) {
          const pb = bPts[i];
          // quick deg-based d2
          const meanLat = (pa.lat + pb.lat) * Math.PI / 360.0;
          const dx = (pa.lng - pb.lng) * Math.cos(meanLat);
          const dy = (pa.lat - pb.lat);
          const d2 = dx*dx + dy*dy;
          if (d2 < best.d2) best = { d2, a: pa, b: pb };
        }
      });
    });
    return (best.a && best.b) ? best : null;
  }

  function clipLatLngsToBox(latlngs, box) {
    // box: {minLat,minLng,maxLat,maxLng}
    const segs = [];
    let cur = [];
    for (let i = 0; i < latlngs.length; i++) {
      const p = latlngs[i];
      const inside = (p.lat >= box.minLat && p.lat <= box.maxLat && p.lng >= box.minLng && p.lng <= box.maxLng);
      if (inside) {
        cur.push(p);
      } else {
        if (cur.length >= 2) segs.push(cur);
        cur = [];
      }
    }
    if (cur.length >= 2) segs.push(cur);
    return segs;
  }

  // ----- Drawing helpers -----
  function addPolylineWithOutline(coords, style, popupHtml, layerGroup, outlineMode) {
    if (outlineMode === "triple") {
      layerGroup.addLayer(L.polyline(coords, { ...style, color: "#000000", weight: (style.weight||4) + 8, opacity: 0.9 }));
      layerGroup.addLayer(L.polyline(coords, { ...style, color: "#ffffff", weight: (style.weight||4) + 4, opacity: 1.0 }));
    } else if (outlineMode === "whiteHalo") {
      layerGroup.addLayer(L.polyline(coords, { ...style, color: "#ffffff", weight: (style.weight||4) + 6, opacity: 1.0 }));
    }
    const core = L.polyline(coords, style);
    if (popupHtml) core.bindPopup(popupHtml);
    layerGroup.addLayer(core);
    return core;
  }

  function riverStyle(tag) {
    // water-system A (same color)
    if (tag === "å¤åˆ©æ ¹å·" || tag === "å¤§è½å¤åˆ©æ ¹å·") return { color: COLOR_MAIN, weight: 5, opacity: 0.95, pane: "paneRivers" };
    if (tag === "å…ƒè’å·") return { color: COLOR_MAIN, weight: 5, opacity: 0.95, pane: "paneRivers" };
    if (tag === "ä¸­å·" || tag === "ç¶¾ç€¬å·") return { color: COLOR_MAIN, weight: 4, opacity: 0.95, pane: "paneRivers", dashArray: (tag==="ç¶¾ç€¬å·" ? "6 6" : undefined) };
    if (tag === "å¿å·") return { color: COLOR_MAIN, weight: 4, opacity: 0.95, pane: "paneLocal" };
    if (tag === "å¿å·ä¸Šæµ") return { color: COLOR_MAIN, weight: 4, opacity: 0.95, pane: "paneLocal", dashArray: "10 6" };
    if (tag === "æ˜Ÿå·") return { color: COLOR_MAIN, weight: 4, opacity: 0.95, pane: "paneLocal" };

    // water-system B (exit / Iruma)
    if (tag === "éš…ç”°å·") return { color: COLOR_EXIT, weight: 4, opacity: 0.95, pane: "paneRivers" };
    if (tag === "å…¥é–“å·") return { color: COLOR_EXIT, weight: 4, opacity: 0.95, pane: "paneRivers" };
    if (tag === "è’å·ãƒªãƒ³ã‚¯") return { color: COLOR_EXIT, weight: 4, opacity: 0.95, pane: "paneRivers" };
    if (tag === "å…¥é–“æ¨å®š") return { color: COLOR_EXIT, weight: 3, opacity: 0.85, pane: "paneRivers", dashArray: "10 6" };
    if (tag === "å…¥é–“æ¨å®š_æ¥ç¶š") return { color: COLOR_EXIT, weight: 3, opacity: 0.85, pane: "paneRivers", dashArray: "4 6" };

    // infra
    if (tag === "æ­¦è”µæ°´è·¯") return { color: "#00bcd4", weight: 4, opacity: 0.95, pane: "paneLocal", dashArray: "10 6" };
    if (tag === "è¦‹æ²¼ä»£ç”¨æ°´") return { color: "#e6ab02", weight: 4, opacity: 0.95, pane: "paneLocal", dashArray: "10 6" };

    return { color: "#000000", weight: 3, opacity: 0.7, pane: "paneRivers" };
  }

  // ----- Shared segments rendering (Hoshikawa Ã— Minuma) -----
  function addSharedHoshikawaMinuma(coords) {
    const popup = "<b>å…±ç”¨åŒºé–“ï¼šæ˜Ÿå· Ã— è¦‹æ²¼ä»£ç”¨æ°´</b><br/>åŒä¸€ã®æ²³é“ã‚’å…±ç”¨ã—ã¦ã„ã‚‹åŒºé–“ï¼ˆOSMã® way ãŒä¸¡æ–¹ã«å±ã™ã‚‹ã¨åˆ¤å®šã§ããŸéƒ¨åˆ†ï¼‰ã€‚<br/><span style='font-size:12px;'>è¡¨ç¤º: æ˜Ÿå·ã®ã¿ONâ†’æ˜Ÿå·è‰² / è¦‹æ²¼ã®ã¿ONâ†’è¦‹æ²¼è‰² / ä¸¡æ–¹ONâ†’äºŒè‰²ã‚¹ãƒˆãƒ©ã‚¤ãƒ—</span>";

    // solid as æ˜Ÿå·
    addPolylineWithOutline(coords, riverStyle("æ˜Ÿå·"), popup, lyrSharedHM_H, "triple");

    // solid as è¦‹æ²¼ä»£ç”¨æ°´
    addPolylineWithOutline(coords, riverStyle("è¦‹æ²¼ä»£ç”¨æ°´"), popup, lyrSharedHM_M, "whiteHalo");

    // striped when both ON
    const stH = riverStyle("æ˜Ÿå·");
    const stM = riverStyle("è¦‹æ²¼ä»£ç”¨æ°´");
    const w = Math.max(stH.weight||4, stM.weight||4);

    const halo = L.polyline(coords, { color:"#ffffff", weight: w + 6, opacity: 1.0, pane: "paneLocal" }).bindPopup(popup);
    const dash = "12 12";
    const hLine = L.polyline(coords, { ...stH, weight: w, dashArray: dash, dashOffset: "0", lineCap: "butt", lineJoin: "round" }).bindPopup(popup);
    const mLine = L.polyline(coords, { ...stM, weight: w, dashArray: dash, dashOffset: "12", lineCap: "butt", lineJoin: "round" }).bindPopup(popup);

    lyrSharedHM_Stripe.addLayer(halo);
    lyrSharedHM_Stripe.addLayer(hLine);
    lyrSharedHM_Stripe.addLayer(mLine);
  }

  function clearSharedHMOnMap() {
    [lyrSharedHM_H, lyrSharedHM_M, lyrSharedHM_Stripe].forEach(l => { if (map.hasLayer(l)) map.removeLayer(l); });
  }

  function updateSharedHMVisibility() {
    clearSharedHMOnMap();
    const hOn = map.hasLayer(lyrHoshikawa);
    const mOn = map.hasLayer(lyrMinumaDaiyosui);
    if (hOn && !mOn) map.addLayer(lyrSharedHM_H);
    else if (!hOn && mOn) map.addLayer(lyrSharedHM_M);
    else if (hOn && mOn) map.addLayer(lyrSharedHM_Stripe);
  }

  map.on('overlayadd', (e) => {
    if (e.layer === lyrHoshikawa || e.layer === lyrMinumaDaiyosui) updateSharedHMVisibility();
  });
  map.on('overlayremove', (e) => {
    if (e.layer === lyrHoshikawa || e.layer === lyrMinumaDaiyosui) updateSharedHMVisibility();
  });

  // ----- OSM name helpers -----
  const CORE_EXACT_NAMES = [
    "å¤§è½å¤åˆ©æ ¹å·","å¤åˆ©æ ¹å·","å…ƒè’å·","ä¸­å·","ç¶¾ç€¬å·",
    "éš…ç”°å·","è’å·","å…¥é–“å·","å¿å·","æ–°å¿å·",
    "æ˜Ÿå·","ä¸Šæ˜Ÿå·","ä¸‹æ˜Ÿå·","æ–°æ˜Ÿå·",
    "æ­¦è”µæ°´è·¯","è¦‹æ²¼ä»£ç”¨æ°´",
    "å’Œç”°å‰é‡å·","å’Œç”°å‰é‡å·æ”¾æ°´è·¯","å¸‚é‡å·"
  ];

  function nameSetAnyExact(nameSet, name) { return nameSet && nameSet.has(name); }
  function nameSetAnyIncludes(nameSet, needle) {
    if (!nameSet) return false;
    for (const n of nameSet) if (String(n).includes(needle)) return true;
    return false;
  }
  function nameSetHasOshikawa(nameSet) { return nameSetAnyExact(nameSet, "å¿å·") || nameSetAnyExact(nameSet, "æ–°å¿å·"); }
  function nameSetHasHoshi(nameSet) {
    return nameSetAnyExact(nameSet, "æ˜Ÿå·") || nameSetAnyExact(nameSet, "ä¸Šæ˜Ÿå·") || nameSetAnyExact(nameSet, "ä¸‹æ˜Ÿå·") || nameSetAnyExact(nameSet, "æ–°æ˜Ÿå·");
  }

  function buildWayNameFromRelations(elements) {
    const m = new Map(); // wayId -> Set(names)
    elements.forEach(el => {
      if (el.type !== "relation") return;
      if (!el.tags || !el.tags.name || !el.members) return;
      const nm = el.tags.name;
      el.members.forEach(mem => {
        if (mem.type !== "way") return;
        if (!m.has(mem.ref)) m.set(mem.ref, new Set());
        m.get(mem.ref).add(nm);
      });
    });
    return m;
  }

  function getNameSet(way, relWayNames) {
    const ns = new Set();
    if (way.tags && way.tags.name) ns.add(way.tags.name);
    if (relWayNames && relWayNames.has(way.id)) {
      relWayNames.get(way.id).forEach(nm => ns.add(nm));
    }
    // Some ways use "alt_name" etc; we keep name only for stability
    return ns;
  }

  function getNodeKeys(way) {
    // For connectivity: use rounded coords as pseudo node keys (geom only)
    if (!way.geometry) return [];
    return way.geometry.map(pt => (pt.lat.toFixed(6) + "," + pt.lon.toFixed(6)));
  }

  function computeOshikawaComponent(ways, relWayNames) {
    const candidate = [];
    const byId = new Map();

    ways.forEach(w => {
      const ns = getNameSet(w, relWayNames);
      if (nameSetHasOshikawa(ns) || nameSetHasHoshi(ns)) {
        byId.set(w.id, { way: w, nameSet: ns, nodeKeys: getNodeKeys(w) });
        candidate.push(w.id);
      }
    });

    const node2ways = new Map();
    candidate.forEach(id => {
      const rec = byId.get(id);
      (rec.nodeKeys || []).forEach(k => {
        if (!node2ways.has(k)) node2ways.set(k, []);
        node2ways.get(k).push(id);
      });
    });

    const startIds = candidate.filter(id => nameSetHasOshikawa(byId.get(id).nameSet));
    const visited = new Set(startIds);
    const stack = startIds.slice();

    while (stack.length) {
      const cur = stack.pop();
      const rec = byId.get(cur);
      if (!rec) continue;
      (rec.nodeKeys || []).forEach(k => {
        const nbrs = node2ways.get(k) || [];
        nbrs.forEach(nid => {
          if (!visited.has(nid)) {
            visited.add(nid);
            stack.push(nid);
          }
        });
      });
    }

    return { oshikawaIds: visited };
  }

  function clearAll() {
    [
      lyrKofurone, lyrMotoArakawa, lyrNakaAyase,
      lyrOshikawa, lyrHoshikawa,
      lyrSumida, lyrIruma, lyrArakawaLink, lyrIrumaPreRoute,
      lyrMusashiSuido, lyrMinumaDaiyosui,
      lyrSharedHM_H, lyrSharedHM_M, lyrSharedHM_Stripe,
      lyrArakawaRaw, lyrIrumaRaw, lyrWadaRaw, lyrIchinoRaw
    ].forEach(l => l.clearLayers());

    // shared groups are controlled manually; remove them from map to avoid stale state
    [lyrSharedHM_H, lyrSharedHM_M, lyrSharedHM_Stripe].forEach(l => { if (map.hasLayer(l)) map.removeLayer(l); });
  }

  // ----- Core draw dispatch -----
  function drawWayByNameSet(way, nameSet, oshikawaIds) {
    if (!way.geometry) return;
    const coords = way.geometry.map(pt => [pt.lat, pt.lon]);
    const inOshikawa = oshikawaIds && oshikawaIds.has(way.id);

    const isMusashi = nameSetAnyIncludes(nameSet, "æ­¦è”µæ°´è·¯");
    const isMinuma  = nameSetAnyIncludes(nameSet, "è¦‹æ²¼ä»£ç”¨æ°´");
    const hasHoshi  = nameSetHasHoshi(nameSet);

    // shared HM segment: only for the "æ˜Ÿå·ï¼ˆå…ƒè’å·æ”¯æµï¼‰" side (NOT the Oshikawa-upper æ˜Ÿå·)
    const isHoshikawaTrib = (!inOshikawa) && hasHoshi;
    const isSharedHM = isMinuma && isHoshikawaTrib;

    if (isSharedHM) {
      addSharedHoshikawaMinuma(coords);
      return;
    }

    if (isMusashi) {
      addPolylineWithOutline(coords, riverStyle("æ­¦è”µæ°´è·¯"),
        "<b>æ­¦è”µæ°´è·¯</b><br/>åˆ©æ ¹å·ï¼ˆåˆ©æ ¹å¤§å °ï¼‰â†’è’å·ã¸å°æ°´ã™ã‚‹è¿‘ä»£ã®æ°´è·¯ã€‚", lyrMusashiSuido, "whiteHalo");
      return;
    }

    if (isMinuma) {
      addPolylineWithOutline(coords, riverStyle("è¦‹æ²¼ä»£ç”¨æ°´"),
        "<b>è¦‹æ²¼ä»£ç”¨æ°´</b><br/>1728å¹´ã«æ•´å‚™ã•ã‚ŒãŸè¦‹æ²¼ä»£ç”¨æ°´ç³»ã€‚", lyrMinumaDaiyosui, "whiteHalo");
      return;
    }

    if (nameSetAnyExact(nameSet, "å¤åˆ©æ ¹å·") || nameSetAnyExact(nameSet, "å¤§è½å¤åˆ©æ ¹å·")) {
      const nm = nameSetAnyExact(nameSet, "å¤§è½å¤åˆ©æ ¹å·") ? "å¤§è½å¤åˆ©æ ¹å·" : "å¤åˆ©æ ¹å·";
      const st = riverStyle(nm);
      const style = { ...st };
      if (nm === "å¤§è½å¤åˆ©æ ¹å·") style.dashArray = "8 6";
      addPolylineWithOutline(coords, style, nm, lyrKofurone, "triple");
      return;
    }

    if (nameSetAnyExact(nameSet, "å…ƒè’å·")) {
      addPolylineWithOutline(coords, riverStyle("å…ƒè’å·"), "å…ƒè’å·", lyrMotoArakawa, "triple");
      return;
    }

    if (nameSetAnyExact(nameSet, "ä¸­å·") || nameSetAnyExact(nameSet, "ç¶¾ç€¬å·")) {
      const nm = nameSetAnyExact(nameSet, "ç¶¾ç€¬å·") ? "ç¶¾ç€¬å·" : "ä¸­å·";
      addPolylineWithOutline(coords, riverStyle(nm), nm, lyrNakaAyase, "triple");
      return;
    }

    if (nameSetAnyExact(nameSet, "éš…ç”°å·")) {
      addPolylineWithOutline(coords, riverStyle("éš…ç”°å·"), "éš…ç”°å·", lyrSumida, "whiteHalo");
      return;
    }

    // raw capture for later filtering / route build
    if (nameSetAnyExact(nameSet, "è’å·")) {
      L.polyline(coords, { color: "#777777", weight: 2, opacity: 0.01, pane: "paneRivers" }).addTo(lyrArakawaRaw);
      return;
    }

    if (nameSetAnyExact(nameSet, "å…¥é–“å·") || nameSetAnyIncludes(nameSet, "å…¥é–“å·")) {
      L.polyline(coords, { color: "#666666", weight: 2, opacity: 0.01, pane: "paneRivers" }).addTo(lyrIrumaRaw);
      return;
    }

    if (nameSetAnyExact(nameSet, "å’Œç”°å‰é‡å·") || nameSetAnyIncludes(nameSet, "å’Œç”°å‰é‡å·")) {
      L.polyline(coords, { color: "#666666", weight: 2, opacity: 0.01, pane: "paneRivers" }).addTo(lyrWadaRaw);
      return;
    }

    if (nameSetAnyExact(nameSet, "å¸‚é‡å·") || nameSetAnyIncludes(nameSet, "å¸‚é‡å·")) {
      L.polyline(coords, { color: "#666666", weight: 2, opacity: 0.01, pane: "paneRivers" }).addTo(lyrIchinoRaw);
      return;
    }

    // å¿å·ç³»ï¼ˆå¿å·ï¼‹å¿å·ä¸Šæµã®ã€Œæ˜Ÿå·ã€ï¼‰
    if (inOshikawa) {
      if (hasHoshi) {
        addPolylineWithOutline(coords, riverStyle("å¿å·ä¸Šæµ"),
          "<b>å¿å·ä¸Šæµï¼šç†Šè°·ä¸­å¿ƒéƒ¨ã®æ˜Ÿå·</b><br/>ï¼ˆç†Šè°·ä¸­å¿ƒéƒ¨ã§ã€Œæ˜Ÿå·ã€ã¨å‘¼ã°ã‚Œã‚‹åŒºé–“ã€‚æ²³å·ã¨ã—ã¦ã¯å¿å·ã®ä¸Šæµã€‚ï¼‰",
          lyrOshikawa, "whiteHalo");
      } else {
        addPolylineWithOutline(coords, riverStyle("å¿å·"), "å¿å·", lyrOshikawa, "whiteHalo");
      }
      return;
    }

    // æ˜Ÿå·ç³»ï¼ˆå…ƒè’å·æ”¯æµï¼‰
    if (hasHoshi) {
      addPolylineWithOutline(coords, riverStyle("æ˜Ÿå·"), "æ˜Ÿå·", lyrHoshikawa, "triple");
      return;
    }
  }

  // ----- Build visible Iruma / Arakawa-link from raw (avoid duplicate-name rivers) -----
  function buildIrumaVisible() {
    lyrIruma.clearLayers();
    const box = { minLat: 35.82, minLng: 139.20, maxLat: 36.08, maxLng: 139.70 }; // ä¸‰é·¹ã®ã€Œåˆ¥å…¥é–“å·ã€é™¤å¤–
    corePolylines(lyrIrumaRaw).forEach(pl => {
      const pts = flattenLatLngs(pl.getLatLngs());
      const segs = clipLatLngsToBox(pts, box);
      segs.forEach(seg => addPolylineWithOutline(seg, riverStyle("å…¥é–“å·"), "å…¥é–“å·ï¼ˆå‚ç…§ï¼‰", lyrIruma, "whiteHalo"));
    });
  }

  function buildArakawaLink() {
    lyrArakawaLink.clearLayers();

    // ã¾ãšã€Œå’Œç”°å‰é‡å·ï¼ˆæœ€ä¸‹æµï¼‰ã€ã®è¿‘å‚ã‚’æ¨å®šã—ã¦ã€ãã“ã‚ˆã‚Šä¸Šæµå´ï¼ˆç†Šè°·ã€œç§©çˆ¶å´ï¼‰ã‚’åˆ‡ã‚Šæ¨ã¦
    const wadaJoin = nearestBetweenGroups(lyrWadaRaw, lyrArakawaRaw);
    const maxLatCut = wadaJoin ? (wadaJoin.b.lat + 0.003) : 36.02;

    // å¹³é‡éƒ¨ã‚³ãƒªãƒ‰ãƒ¼ï¼ˆæ ƒæœ¨å¸‚å´ã®åˆ¥ã€Œè’å·ã€ãªã©é‡åã‚’é™¤å¤–ï¼‰
    // ã€Œéš…ç”°å·ã®æœ€ä¸Šæµï¼ˆå²©æ·µä»˜è¿‘ï¼‰ã€ã‚ˆã‚Šä¸‹æµå´ï¼ˆç¾è’å·ã®æ”¾æ°´è·¯åŒºé–“ã€œæ²³å£ï¼‰ã¯1590è¡¨ç¤ºã§ã¯ä½¿ã‚ãªã„
    // â€»éš…ç”°å·ãã®ã‚‚ã®ï¼ˆå‡ºå£å‚ç…§ï¼‰ã¯åˆ¥ãƒ¬ã‚¤ãƒ¤ã§è¡¨ç¤º
    // ã¾ãšã¯ã€Œè’å·ã€Ã—ã€Œéš…ç”°å·ã€ãŒæœ€ã‚‚è¿‘ã„åœ°ç‚¹ï¼ˆï¼å²©æ·µä»˜è¿‘ã«ãªã‚Šã‚„ã™ã„ï¼‰ã‚’æ¡ç”¨
    const as0 = nearestBetweenGroups(lyrArakawaRaw, lyrSumida);
    let minLatCut = 35.78;
    if (as0 && approxDistKm(as0.a, as0.b) < 0.5) {
      minLatCut = as0.a.lat - 0.002;
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šéš…ç”°å·ã®æœ€å¤§ç·¯åº¦ï¼ˆè¡¨ç¤ºç¯„å›²å†…ï¼‰ã‚’æœ€ä¸Šæµæ‰±ã„ã«ã™ã‚‹
      let sumidaHeadLat = -90;
      corePolylines(lyrSumida).forEach(pl => {
        flattenLatLngs(pl.getLatLngs()).forEach(p => { if (p.lat > sumidaHeadLat) sumidaHeadLat = p.lat; });
      });
      if (isFinite(sumidaHeadLat) && sumidaHeadLat > -80) minLatCut = sumidaHeadLat - 0.002;
    }

    const box = { minLat: minLatCut, minLng: 139.35, maxLat: maxLatCut, maxLng: 139.85 };

    corePolylines(lyrArakawaRaw).forEach(pl => {
      const pts = flattenLatLngs(pl.getLatLngs());
      const segs = clipLatLngsToBox(pts, box);
      segs.forEach(seg => addPolylineWithOutline(seg, riverStyle("è’å·ãƒªãƒ³ã‚¯"),
        "ï¼ˆå‚ç…§ï¼‰ç¾è’å·ã®ã†ã¡è©²å½“åŒºé–“ï¼ˆå’Œç”°ä¸‹æµâ†’å…¥é–“åˆæµâ†’éš…ç”°ä¸Šæµï¼‰", lyrArakawaLink, "whiteHalo"));
    });
  }

  // ----- Build pre-route (dashed) -----
  function buildIrumaPreRoute() {
    lyrIrumaPreRoute.clearLayers();

    const st = riverStyle("å…¥é–“æ¨å®š");
    const stConn = riverStyle("å…¥é–“æ¨å®š_æ¥ç¶š");

    // æ¨å®šãƒ«ãƒ¼ãƒˆæœ¬ä½“ï¼ˆå’Œç”°ãƒ»å¸‚é‡ãƒ»å…¥é–“ãƒ»è’å·ãƒªãƒ³ã‚¯ãƒ»éš…ç”°ã‚’åŒè‰²ç ´ç·šã§â€œèª­ã‚€â€ï¼‰
    corePolylines(lyrWadaRaw).forEach(pl => L.polyline(pl.getLatLngs(), st).addTo(lyrIrumaPreRoute));
    corePolylines(lyrIchinoRaw).forEach(pl => L.polyline(pl.getLatLngs(), st).addTo(lyrIrumaPreRoute));
    corePolylines(lyrIruma).forEach(pl => L.polyline(pl.getLatLngs(), st).addTo(lyrIrumaPreRoute));
    corePolylines(lyrArakawaLink).forEach(pl => L.polyline(pl.getLatLngs(), st).addTo(lyrIrumaPreRoute));
    corePolylines(lyrSumida).forEach(pl => L.polyline(pl.getLatLngs(), st).addTo(lyrIrumaPreRoute));

    // ã¤ãªãï¼ˆæ³¨æ„ï¼‰: ã€Œä¸‰ã‚±å°»ä»˜è¿‘ã®ç›´ç·šç‚¹ç·šã€ãŒèª¤èªã•ã‚Œã‚„ã™ã„ãŸã‚ã€å’Œç”°â†’å¸‚é‡ã®ç›´ç·šæ¥ç¶šã¯æã‹ãªã„

    const ii = nearestBetweenGroups(lyrIchinoRaw, lyrIruma);
    if (ii && approxDistKm(ii.a, ii.b) < 3.0) {
      L.polyline([ii.a, ii.b], stConn).bindPopup("<b>æ¨å®š</b>: å¸‚é‡å·â†’å…¥é–“å·ç­‹").addTo(lyrIrumaPreRoute);
    }

    const ra = nearestBetweenGroups(lyrIruma, lyrArakawaLink);
    if (ra && approxDistKm(ra.a, ra.b) < 2.5) {
      L.polyline([ra.a, ra.b], stConn).bindPopup("<b>æ¨å®š</b>: å…¥é–“å· åˆæµ").addTo(lyrIrumaPreRoute);
    }

    const as = nearestBetweenGroups(lyrArakawaLink, lyrSumida);
    if (as && approxDistKm(as.a, as.b) < 15.0) {
      // ä¸‹æµã®ä¸é‡ã€œèµ¤ç¾½ã‚ãŸã‚Šã¯ã€Œç›®å®‰ã¨ã—ã¦OKã€ã¨ã®ã“ã¨ãªã®ã§ã€ã“ã“ã¯æ®‹ã™ï¼ˆå¿…è¦ãªã‚‰é–¾å€¤ã§èª¿æ•´ï¼‰
      L.polyline([as.a, as.b], stConn).bindPopup("<b>æ¨å®š</b>: ï¼ˆæ—§æ²³é“ï¼‰â†’éš…ç”°å·ç­‹ å–ã‚Šä»˜ãï¼ˆå²©æ·µä»˜è¿‘ï¼‰").addTo(lyrIrumaPreRoute);
    }
  }

  // ----- ä¸Šæµæ¥ç¶šï¼ˆæ‰‹æãæ¨å®šãƒ©ã‚¤ãƒ³ï¼‰ -----
  function addNakaAyaseUpstreamExt() {
    // æ—§åˆ©æ ¹å·æœ¬æµï¼ˆä¸­å·ãƒ»ç¶¾ç€¬ï¼‰ã®ä¸Šæµå´å»¶ä¼¸ â€” ç¾¤é¦¬æ–¹é¢ã‹ã‚‰ã®æ—§åˆ©æ ¹å·ã¨ã®æ¥ç¶š
    // 1590å¹´é ƒã€åˆ©æ ¹å·ã¯ç¾¤é¦¬ã‹ã‚‰å—ä¸‹ã—ä¸­å·ãƒ»ç¶¾ç€¬å·ç­‹ã¸æµã‚Œã¦ã„ãŸï¼ˆæ±é·äº‹æ¥­ä»¥å‰ï¼‰
    const coords = [
      // === 1590å¹´ä»¥å‰ã®åˆ©æ ¹å·å—ä¸‹ãƒ«ãƒ¼ãƒˆï¼ˆæ±é·å‰ï¼‰â€” æ²³å·OSMãƒ‡ãƒ¼ã‚¿æ´»ç”¨ç‰ˆ ===
      // --- çƒå·ï¼ˆç¾¤é¦¬ä¸­éƒ¨â†’æœ¬åº„ãƒ»æ·±è°·ä»˜è¿‘, 152ç‚¹ï¼‰ ---
      [36.41172, 138.79888],
      [36.41041, 138.79993],
      [36.40734, 138.80165],
      [36.40516, 138.80385],
      [36.40299, 138.80648],
      [36.40185, 138.80786],
      [36.39904, 138.81338],
      [36.39854, 138.81484],
      [36.39722, 138.81529],
      [36.39522, 138.81636],
      [36.39383, 138.81724],
      [36.39209, 138.81973],
      [36.39118, 138.82083],
      [36.38963, 138.82265],
      [36.38922, 138.82527],
      [36.38936, 138.82652],
      [36.38928, 138.82782],
      [36.38911, 138.82989],
      [36.38871, 138.83141],
      [36.38822, 138.83318],
      [36.38743, 138.83505],
      [36.38728, 138.83667],
      [36.38653, 138.83812],
      [36.38546, 138.83815],
      [36.38451, 138.83823],
      [36.38393, 138.83897],
      [36.38398, 138.84049],
      [36.38439, 138.84251],
      [36.38442, 138.8437],
      [36.38582, 138.84363],
      [36.38701, 138.84345],
      [36.38771, 138.84422],
      [36.38709, 138.84611],
      [36.38601, 138.84857],
      [36.38456, 138.8509],
      [36.38458, 138.85245],
      [36.38533, 138.8542],
      [36.38538, 138.85573],
      [36.38508, 138.8578],
      [36.38417, 138.85846],
      [36.3835, 138.8589],
      [36.38348, 138.85997],
      [36.38325, 138.86133],
      [36.38352, 138.86198],
      [36.38377, 138.86281],
      [36.38334, 138.8642],
      [36.38231, 138.86556],
      [36.38123, 138.867],
      [36.38128, 138.86821],
      [36.38229, 138.86934],
      [36.38157, 138.87102],
      [36.38068, 138.87183],
      [36.38045, 138.87352],
      [36.38071, 138.8755],
      [36.38082, 138.87731],
      [36.38026, 138.87913],
      [36.38026, 138.88258],
      [36.38108, 138.88524],
      [36.38226, 138.8878],
      [36.38297, 138.88966],
      [36.38329, 138.89041],
      [36.38304, 138.89193],
      [36.3821, 138.89431],
      [36.38135, 138.89648],
      [36.38005, 138.89886],
      [36.37827, 138.90188],
      [36.37787, 138.90501],
      [36.37528, 138.90985],
      [36.37316, 138.91261],
      [36.37188, 138.9136],
      [36.37062, 138.91419],
      [36.37036, 138.91574],
      [36.36972, 138.91693],
      [36.36852, 138.91841],
      [36.36723, 138.91928],
      [36.36616, 138.92094],
      [36.3656, 138.92191],
      [36.36499, 138.92306],
      [36.36408, 138.92558],
      [36.36333, 138.92617],
      [36.36249, 138.92787],
      [36.36165, 138.93068],
      [36.36107, 138.93292],
      [36.35868, 138.93428],
      [36.35723, 138.93693],
      [36.35697, 138.94374],
      [36.3567, 138.94756],
      [36.35666, 138.94923],
      [36.35617, 138.95067],
      [36.35556, 138.95289],
      [36.35495, 138.95388],
      [36.35478, 138.95548],
      [36.35417, 138.95699],
      [36.35345, 138.9583],
      [36.35066, 138.95955],
      [36.34917, 138.96215],
      [36.34806, 138.96427],
      [36.34667, 138.96499],
      [36.34619, 138.96736],
      [36.3457, 138.96929],
      [36.34433, 138.97063],
      [36.34423, 138.97345],
      [36.34397, 138.97535],
      [36.34309, 138.97642],
      [36.34266, 138.97757],
      [36.34284, 138.97889],
      [36.34138, 138.9796],
      [36.34094, 138.9799],
      [36.33975, 138.9814],
      [36.33871, 138.98291],
      [36.33801, 138.98402],
      [36.33666, 138.98577],
      [36.33541, 138.98792],
      [36.33295, 138.98919],
      [36.33102, 138.99224],
      [36.3281, 138.9951],
      [36.32586, 138.9973],
      [36.3238, 138.99816],
      [36.31238, 139.00669],
      [36.30858, 139.01038],
      [36.30674, 139.01255],
      [36.30291, 139.01476],
      [36.30133, 139.01634],
      [36.30023, 139.01918],
      [36.29619, 139.02136],
      [36.29393, 139.02281],
      [36.29247, 139.02702],
      [36.29166, 139.02934],
      [36.28961, 139.03191],
      [36.28773, 139.03543],
      [36.28819, 139.03861],
      [36.28805, 139.04133],
      [36.29316, 139.0451],
      [36.29372, 139.04704],
      [36.29314, 139.0524],
      [36.29169, 139.05791],
      [36.29039, 139.06125],
      [36.28944, 139.06598],
      [36.29094, 139.07434],
      [36.29066, 139.08264],
      [36.29059, 139.089],
      [36.29058, 139.09173],
      [36.28982, 139.09341],
      [36.28744, 139.09644],
      [36.28591, 139.10007],
      [36.28317, 139.10444],
      [36.2823, 139.11704],
      [36.27964, 139.12529],
      [36.28032, 139.13171],
      [36.27867, 139.13992],
      [36.27646, 139.14456],
      [36.27753, 139.154],
      // --- çƒå·â†’å…ƒå°å±±å· æ©‹æ¸¡ã—ï¼ˆ1ç‚¹ï¼‰ ---
      [36.268, 139.157],
      // --- å…ƒå°å±±å·ï¼ˆç¥å·ç”ºâ†’æ·±è°·å¸‚ä»˜è¿‘, 225ç‚¹ï¼‰ ---
      [36.2587951, 139.1604511],
      [36.2587548, 139.1605281],
      [36.258589, 139.160944],
      [36.2584286, 139.1612709],
      [36.2582714, 139.1615201],
      [36.2578872, 139.1621745],
      [36.2575353, 139.1626713],
      [36.2572913, 139.163031],
      [36.2569456, 139.1635334],
      [36.2567536, 139.163795],
      [36.2565497, 139.1640996],
      [36.2563708, 139.1643884],
      [36.256132, 139.164631],
      [36.255996, 139.164783],
      [36.255735, 139.165019],
      [36.255618, 139.165111],
      [36.255478, 139.165202],
      [36.2552762, 139.1653609],
      [36.25473, 139.1656786],
      [36.2543933, 139.1658042],
      [36.2540527, 139.1659821],
      [36.2538654, 139.1661408],
      [36.2537084, 139.1662862],
      [36.2535543, 139.1664883],
      [36.2534108, 139.1666761],
      [36.253298, 139.166871],
      [36.253236, 139.167087],
      [36.253203, 139.167323],
      [36.253186, 139.167699],
      [36.253206, 139.168143],
      [36.2533066, 139.1688929],
      [36.253399, 139.1695633],
      [36.253404, 139.169909],
      [36.253437, 139.170145],
      [36.253462, 139.170334],
      [36.253469, 139.170547],
      [36.253456, 139.170759],
      [36.253401, 139.171177],
      [36.253381, 139.171277],
      [36.253363, 139.17135],
      [36.253335, 139.171426],
      [36.253287, 139.171528],
      [36.253251, 139.171603],
      [36.253212, 139.171661],
      [36.253152, 139.171758],
      [36.253003, 139.171947],
      [36.252816, 139.172274],
      [36.252617, 139.172678],
      [36.252431, 139.173047],
      [36.252374, 139.173156],
      [36.2522552, 139.1733456],
      [36.2522146, 139.1734405],
      [36.2521423, 139.1736094],
      [36.2520058, 139.1739525],
      [36.2518243, 139.1744006],
      [36.2516655, 139.1748975],
      [36.251624, 139.175097],
      [36.251571, 139.175214],
      [36.251493, 139.175357],
      [36.25143, 139.1754222],
      [36.2513914, 139.1754736],
      [36.251301, 139.1755106],
      [36.2512255, 139.1755379],
      [36.251147, 139.1755423],
      [36.2510506, 139.175532],
      [36.2509613, 139.1755079],
      [36.2507007, 139.1754348],
      [36.2505125, 139.1754218],
      [36.2504033, 139.1754554],
      [36.2502929, 139.1755095],
      [36.2501648, 139.1755639],
      [36.2499907, 139.1757203],
      [36.2496214, 139.1763076],
      [36.249513, 139.17648],
      [36.249229, 139.176806],
      [36.248593, 139.177552],
      [36.248191, 139.178073],
      [36.248057, 139.178259],
      [36.247869, 139.178604],
      [36.247734, 139.17887],
      [36.247462, 139.179422],
      [36.247197, 139.179967],
      [36.2469, 139.180621],
      [36.246576, 139.181335],
      [36.2463011, 139.181989],
      [36.2462023, 139.1822139],
      [36.2461102, 139.1824753],
      [36.2460248, 139.1827211],
      [36.2458384, 139.1833525],
      [36.2457951, 139.18361],
      [36.245715, 139.183984],
      [36.245668, 139.184478],
      [36.245665, 139.184832],
      [36.24565, 139.185176],
      [36.2456292, 139.1853767],
      [36.2455362, 139.1857906],
      [36.2454437, 139.1860893],
      [36.245241, 139.186478],
      [36.245039, 139.186902],
      [36.2447857, 139.1876143],
      [36.2446004, 139.1882024],
      [36.2444528, 139.1887537],
      [36.2443592, 139.1891768],
      [36.2442239, 139.1898049],
      [36.2441919, 139.1900522],
      [36.2441023, 139.1904601],
      [36.2440135, 139.1910289],
      [36.2439692, 139.1913217],
      [36.243967, 139.1917307],
      [36.2440142, 139.1920452],
      [36.2441038, 139.1923634],
      [36.2442655, 139.1927115],
      [36.244389, 139.1928653],
      [36.244585, 139.193184],
      [36.244749, 139.193382],
      [36.2448471, 139.1935591],
      [36.2449442, 139.1937377],
      [36.2450059, 139.1938783],
      [36.2450573, 139.194107],
      [36.2450587, 139.1944231],
      [36.244957, 139.194751],
      [36.244804, 139.195177],
      [36.244732, 139.195411],
      [36.244597, 139.195737],
      [36.244298, 139.196501],
      [36.244259, 139.196613],
      [36.244118, 139.196953],
      [36.243881, 139.197377],
      [36.243679, 139.197641],
      [36.243619, 139.1977],
      [36.24356, 139.197759],
      [36.243374, 139.197884],
      [36.243256, 139.197926],
      [36.242045, 139.198259],
      [36.24191, 139.198308],
      [36.24147, 139.198558],
      [36.241211, 139.198738],
      [36.241014, 139.198919],
      [36.240692, 139.199291],
      [36.240563, 139.199487],
      [36.240411, 139.199718],
      [36.24031, 139.200017],
      [36.240237, 139.200336],
      [36.240242, 139.200489],
      [36.240271, 139.200663],
      [36.24031, 139.200767],
      [36.2403632, 139.200956],
      [36.2405527, 139.2012937],
      [36.2408193, 139.2015977],
      [36.2410267, 139.2019046],
      [36.2411718, 139.2021178],
      [36.2412275, 139.2022993],
      [36.2412684, 139.2025593],
      [36.2412766, 139.2028988],
      [36.241245, 139.203678],
      [36.2412322, 139.2043019],
      [36.2411626, 139.204691],
      [36.241068, 139.2049397],
      [36.2409626, 139.20516],
      [36.240862, 139.2053595],
      [36.2407328, 139.2055313],
      [36.240627, 139.2056565],
      [36.2393362, 139.2067779],
      [36.2380237, 139.2078964],
      [36.237793, 139.2080914],
      [36.2375735, 139.2083135],
      [36.2373589, 139.2085805],
      [36.2371891, 139.2088902],
      [36.2370934, 139.209164],
      [36.2370154, 139.2094696],
      [36.2369744, 139.2097715],
      [36.2369511, 139.2101042],
      [36.2369631, 139.2102664],
      [36.23693, 139.2117566],
      [36.2368776, 139.212359],
      [36.2368199, 139.2127454],
      [36.2367294, 139.2130566],
      [36.2366226, 139.2133754],
      [36.236462, 139.2137512],
      [36.2362783, 139.2140936],
      [36.2359354, 139.2146977],
      [36.2356447, 139.2153441],
      [36.2355015, 139.2157756],
      [36.2354628, 139.2159776],
      [36.2354439, 139.2163309],
      [36.2354387, 139.2171061],
      [36.2353729, 139.2175022],
      [36.2353109, 139.2177453],
      [36.235186, 139.2179989],
      [36.2350383, 139.2182025],
      [36.2348453, 139.2184077],
      [36.2346955, 139.2185485],
      [36.2344566, 139.2187423],
      [36.2334419, 139.2197288],
      [36.2332289, 139.2199513],
      [36.2329495, 139.2203271],
      [36.2328098, 139.2206057],
      [36.2326832, 139.2209552],
      [36.2326189, 139.2212278],
      [36.2325868, 139.2215777],
      [36.2325963, 139.2218648],
      [36.2326327, 139.2222346],
      [36.2327084, 139.2227603],
      [36.232734, 139.2230502],
      [36.2327299, 139.2232356],
      [36.2327256, 139.2234453],
      [36.232668, 139.2237278],
      [36.2325783, 139.2240644],
      [36.2324668, 139.22429],
      [36.2322269, 139.2246378],
      [36.232018, 139.2248983],
      [36.2314823, 139.2256193],
      [36.2307386, 139.2266238],
      [36.2303304, 139.227156],
      [36.2301598, 139.2273412],
      [36.2298521, 139.2276057],
      [36.229696, 139.227693],
      [36.229095, 139.227903],
      [36.228954, 139.228021],
      [36.2287509, 139.2281809],
      [36.2286566, 139.2283078],
      [36.228514, 139.2285879],
      [36.2284389, 139.228743],
      [36.2283305, 139.2290251],
      [36.2280001, 139.2296939],
      // --- ç¦å·ï¼ˆæœ¬åº„å¸‚â†’ç†Šè°·å¸‚ä»˜è¿‘, 417ç‚¹ï¼‰ ---
      [36.2243791, 139.2352223],
      [36.2236588, 139.2350024],
      [36.2236269, 139.2353166],
      [36.223554, 139.23546],
      [36.223445, 139.235611],
      [36.223246, 139.235915],
      [36.222836, 139.236525],
      [36.222745, 139.236657],
      [36.222649, 139.236791],
      [36.222611, 139.236845],
      [36.222268, 139.237366],
      [36.222166, 139.237504],
      [36.222127, 139.237569],
      [36.222076, 139.237651],
      [36.221932, 139.237862],
      [36.221868, 139.237935],
      [36.2218084, 139.2379382],
      [36.2197384, 139.2382058],
      [36.2196361, 139.2384798],
      [36.2194774, 139.2388978],
      [36.2194557, 139.2389549],
      [36.219434, 139.239012],
      [36.2193011, 139.2393666],
      [36.2191459, 139.2396346],
      [36.2189977, 139.2399033],
      [36.2188466, 139.240171],
      [36.218833, 139.2401934],
      [36.218704, 139.2404069],
      [36.2186309, 139.2405345],
      [36.2157742, 139.2455229],
      [36.210319, 139.255017],
      [36.2102419, 139.2551686],
      [36.2101451, 139.2553897],
      [36.2100559, 139.2556716],
      [36.2100113, 139.2559135],
      [36.20999, 139.256095],
      [36.209993, 139.256332],
      [36.21002, 139.256621],
      [36.2106761, 139.2625214],
      [36.2107383, 139.2630709],
      [36.2108174, 139.2638219],
      [36.2108725, 139.2643452],
      [36.2109254, 139.2648382],
      [36.2109688, 139.2652749],
      [36.2110622, 139.2662151],
      [36.2110996, 139.266594],
      [36.211097, 139.266848],
      [36.21109, 139.267018],
      [36.211041, 139.267285],
      [36.210955, 139.267604],
      [36.210856, 139.267874],
      [36.2106131, 139.2682726],
      [36.2104027, 139.2685295],
      [36.2099199, 139.2690666],
      [36.2094374, 139.2695778],
      [36.2093579, 139.269668],
      [36.2084515, 139.2706733],
      [36.20837, 139.270797],
      [36.208072, 139.271131],
      [36.2078293, 139.2714022],
      [36.207757, 139.271483],
      [36.207672, 139.271594],
      [36.207568, 139.271735],
      [36.207441, 139.271929],
      [36.207383, 139.27204],
      [36.207277, 139.272296],
      [36.2071791, 139.2726372],
      [36.207115, 139.272953],
      [36.207062, 139.273287],
      [36.207015, 139.273635],
      [36.207013, 139.27392],
      [36.2070014, 139.2743477],
      [36.206993, 139.274657],
      [36.20697, 139.275318],
      [36.206951, 139.275673],
      [36.206935, 139.27645],
      [36.206916, 139.276945],
      [36.2069167, 139.2771027],
      [36.2068881, 139.2776874],
      [36.2068598, 139.27844],
      [36.2068106, 139.2794016],
      [36.2067564, 139.2803886],
      [36.2067243, 139.2810729],
      [36.2066949, 139.2813783],
      [36.2065875, 139.282043],
      [36.2063659, 139.2833667],
      [36.2063316, 139.2836154],
      [36.2062752, 139.2844646],
      [36.2062338, 139.2847211],
      [36.2060677, 139.2857016],
      [36.2059758, 139.2862249],
      [36.2058274, 139.2870697],
      [36.2057848, 139.2873764],
      [36.2057912, 139.2876917],
      [36.2057807, 139.2877582],
      [36.2056287, 139.2887668],
      [36.2056075, 139.2888776],
      [36.2055616, 139.2890049],
      [36.2055166, 139.289166],
      [36.2054096, 139.2897555],
      [36.2053695, 139.2900497],
      [36.2053535, 139.2902972],
      [36.205351, 139.2906074],
      [36.205363, 139.2909675],
      [36.205374, 139.291309],
      [36.2053983, 139.2916987],
      [36.2054047, 139.2919531],
      [36.2053892, 139.2923523],
      [36.2053191, 139.2932839],
      [36.205281, 139.294106],
      [36.205278, 139.294438],
      [36.2052373, 139.294795],
      [36.2052198, 139.2950757],
      [36.205189, 139.295425],
      [36.2051996, 139.2962143],
      [36.2052991, 139.29728],
      [36.2053574, 139.2978538],
      [36.2053789, 139.2980733],
      [36.2053915, 139.298287],
      [36.2053872, 139.2985089],
      [36.2053802, 139.2987835],
      [36.2053599, 139.2989096],
      [36.2052968, 139.299143],
      [36.2052695, 139.2992289],
      [36.2051511, 139.2994252],
      [36.2049343, 139.2999382],
      [36.2047026, 139.300477],
      [36.2041554, 139.3016362],
      [36.2038677, 139.3024632],
      [36.2035996, 139.3032577],
      [36.203476, 139.3036288],
      [36.2032779, 139.3041701],
      [36.2031676, 139.3043974],
      [36.2028953, 139.3047877],
      [36.2026244, 139.30503],
      [36.2023339, 139.3052551],
      [36.2021319, 139.3054286],
      [36.2019428, 139.3056659],
      [36.2017667, 139.3059064],
      [36.201626, 139.3062751],
      [36.201498, 139.3068669],
      [36.2013477, 139.3073818],
      [36.201246, 139.3077996],
      [36.2010101, 139.3086567],
      [36.2009222, 139.3089906],
      [36.2008812, 139.3092101],
      [36.2008584, 139.3092833],
      [36.2008326, 139.3095865],
      [36.2007724, 139.3101442],
      [36.2007399, 139.310511],
      [36.2007094, 139.3110098],
      [36.2006107, 139.3115764],
      [36.2004494, 139.3121176],
      [36.2002836, 139.3124927],
      [36.1999728, 139.31315],
      [36.199509, 139.314086],
      [36.199181, 139.314823],
      [36.198517, 139.316218],
      [36.198337, 139.316587],
      [36.198237, 139.316863],
      [36.1982069, 139.3171235],
      [36.198162, 139.3173636],
      [36.1981293, 139.3176831],
      [36.1981507, 139.318066],
      [36.198188, 139.318281],
      [36.198218, 139.318417],
      [36.1982585, 139.3185738],
      [36.198284, 139.318664],
      [36.19838, 139.318882],
      [36.198545, 139.319132],
      [36.19883, 139.319446],
      [36.198989, 139.319568],
      [36.199197, 139.3197],
      [36.199209, 139.319708],
      [36.199782, 139.32011],
      [36.199974, 139.320213],
      [36.200629, 139.320614],
      [36.201132, 139.320903],
      [36.201666, 139.321242],
      [36.202324, 139.321644],
      [36.202699, 139.321895],
      [36.202988, 139.322116],
      [36.203181, 139.322295],
      [36.203335, 139.322459],
      [36.203474, 139.322614],
      [36.2038305, 139.3230702],
      [36.2040032, 139.3232239],
      [36.204281, 139.3234462],
      [36.2045886, 139.3235989],
      [36.2051528, 139.3236605],
      [36.2058446, 139.3235826],
      [36.2063775, 139.3235368],
      [36.2067092, 139.323554],
      [36.2069216, 139.3236042],
      [36.2071554, 139.3236978],
      [36.2073271, 139.3238352],
      [36.2076816, 139.3241032],
      [36.2082311, 139.3245223],
      [36.2088643, 139.3250285],
      [36.209054, 139.32523],
      [36.209168, 139.325467],
      [36.209343, 139.325856],
      [36.209478, 139.326129],
      [36.209646, 139.326435],
      [36.209834, 139.326731],
      [36.210075, 139.327071],
      [36.210174, 139.327248],
      [36.210237, 139.327403],
      [36.210285, 139.327587],
      [36.210326, 139.327771],
      [36.210348, 139.328224],
      [36.210374, 139.328834],
      [36.210434, 139.329088],
      [36.2105151, 139.3293342],
      [36.2106745, 139.3296137],
      [36.2108043, 139.3297972],
      [36.2111827, 139.330111],
      [36.2115391, 139.3303584],
      [36.2118902, 139.330606],
      [36.2122584, 139.3308889],
      [36.2124008, 139.3310324],
      [36.2125675, 139.3314058],
      [36.212749, 139.331862],
      [36.212823, 139.332227],
      [36.212856, 139.332634],
      [36.212808, 139.332937],
      [36.212716, 139.333364],
      [36.212584, 139.333806],
      [36.212469, 139.334178],
      [36.212348, 139.334595],
      [36.212226, 139.334993],
      [36.212041, 139.335751],
      [36.211975, 139.336017],
      [36.211916, 139.336252],
      [36.211792, 139.336854],
      [36.211769, 139.336967],
      [36.211651, 139.337302],
      [36.211645, 139.337314],
      [36.211469, 139.337677],
      [36.211381, 139.337861],
      [36.211241, 139.338071],
      [36.211153, 139.3382],
      [36.211123, 139.338244],
      [36.211107, 139.338271],
      [36.210921, 139.338569],
      [36.210836, 139.338716],
      [36.210744, 139.339003],
      [36.210624, 139.339562],
      [36.210569, 139.33996],
      [36.210521, 139.340343],
      [36.210514, 139.340778],
      [36.210577, 139.341132],
      [36.210643, 139.341346],
      [36.2107178, 139.3417422],
      [36.2107504, 139.3419679],
      [36.210732, 139.342181],
      [36.2107251, 139.342313],
      [36.2106618, 139.3425901],
      [36.2105543, 139.3428464],
      [36.2104622, 139.3430227],
      [36.2103001, 139.3432387],
      [36.2085717, 139.3450097],
      [36.2084032, 139.3451993],
      [36.2082425, 139.3454337],
      [36.2081177, 139.3456631],
      [36.2080223, 139.3458719],
      [36.2079166, 139.3460807],
      [36.2078309, 139.3462226],
      [36.2077298, 139.3463582],
      [36.2076012, 139.3464867],
      [36.2074163, 139.3466536],
      [36.2067645, 139.3470744],
      [36.2063147, 139.3473727],
      [36.2061673, 139.3475024],
      [36.2060517, 139.3476678],
      [36.205972, 139.3478159],
      [36.2059235, 139.3479777],
      [36.2058907, 139.3481461],
      [36.2058794, 139.3485362],
      [36.2058577, 139.3496567],
      [36.2058347, 139.3505295],
      [36.2058651, 139.3509478],
      [36.2059267, 139.3513725],
      [36.2060209, 139.3517625],
      [36.2064278, 139.3527845],
      [36.2065821, 139.3531454],
      [36.2067798, 139.3537247],
      [36.2069263, 139.3543365],
      [36.2071423, 139.354835],
      [36.2073273, 139.3552388],
      [36.2081467, 139.3569616],
      [36.2083111, 139.35729],
      [36.2083709, 139.3574155],
      [36.2088075, 139.3583726],
      [36.2089022, 139.3586384],
      [36.2089711, 139.3589308],
      [36.2090261, 139.3592437],
      [36.2090469, 139.3595884],
      [36.209042, 139.3600188],
      [36.2089943, 139.360481],
      [36.2088112, 139.362484],
      [36.2087099, 139.3637411],
      [36.208686, 139.364004],
      [36.2086294, 139.3645301],
      [36.2086263, 139.366653],
      [36.2086266, 139.3687816],
      [36.2086054, 139.3690307],
      [36.2085669, 139.3692986],
      [36.2084942, 139.369593],
      [36.2083574, 139.3699725],
      [36.208215, 139.3702574],
      [36.207916, 139.370899],
      [36.2076809, 139.3714131],
      [36.2074502, 139.371997],
      [36.2072439, 139.3726487],
      [36.2071005, 139.3731636],
      [36.2069781, 139.3737704],
      [36.2068499, 139.3744282],
      [36.2066543, 139.3755303],
      [36.2048666, 139.3855761],
      [36.2048603, 139.3856456],
      [36.2048242, 139.3859195],
      [36.2048048, 139.3862631],
      [36.2048051, 139.386573],
      [36.2048613, 139.3880168],
      [36.2048671, 139.3882331],
      [36.2048343, 139.3884719],
      [36.2048126, 139.3886273],
      [36.2047695, 139.38883],
      [36.2047472, 139.3889358],
      [36.2046446, 139.3892357],
      [36.2040481, 139.3908828],
      [36.2038399, 139.3915302],
      [36.2034851, 139.3930152],
      [36.2029011, 139.3957609],
      [36.2027786, 139.396183],
      [36.2026873, 139.396477],
      [36.202255, 139.397554],
      [36.2019146, 139.3984154],
      [36.201826, 139.398994],
      [36.201765, 139.39948],
      [36.20174, 139.399938],
      [36.201715, 139.400477],
      [36.201699, 139.401074],
      [36.201658, 139.402131],
      [36.201648, 139.402873],
      [36.201616, 139.403718],
      [36.2015937, 139.4047695],
      [36.2015656, 139.4054816],
      [36.2015387, 139.405695],
      [36.2014918, 139.4059498],
      [36.2014236, 139.406235],
      [36.2011701, 139.4073472],
      [36.200988, 139.408069],
      [36.200896, 139.408415],
      [36.200618, 139.409631],
      [36.200409, 139.410545],
      [36.200152, 139.411621],
      [36.199936, 139.412599],
      [36.199872, 139.413024],
      [36.199802, 139.413535],
      [36.199691, 139.414205],
      [36.199638, 139.41457],
      [36.199478, 139.415552],
      [36.199437, 139.415805],
      [36.199281, 139.416799],
      [36.199145, 139.41758],
      [36.198929, 139.418999],
      [36.198754, 139.420072],
      [36.198653, 139.420713],
      [36.198521, 139.421643],
      [36.198366, 139.422735],
      [36.19831, 139.4231534],
      [36.1981211, 139.42457],
      [36.1980094, 139.4249877],
      [36.1979241, 139.4254875],
      [36.1978098, 139.425808],
      [36.1976845, 139.4260874],
      [36.1974278, 139.4264782],
      [36.196977, 139.42699],
      [36.196659, 139.427392],
      [36.196468, 139.427701],
      [36.196345, 139.428121],
      [36.196268, 139.428634],
      [36.196211, 139.429324],
      [36.196134, 139.430436],
      [36.1961242, 139.4306183],
      [36.196012, 139.4327153],
      [36.1959978, 139.4329798],
      [36.1959536, 139.433555],
      [36.195899, 139.4338108],
      [36.1956796, 139.434519],
      [36.1953125, 139.4356366],
      [36.195256, 139.4358249],
      [36.1952164, 139.4359991],
      [36.1951628, 139.4363722],
      [36.1950941, 139.4372754],
      [36.1950503, 139.4376577],
      [36.1949595, 139.4379546],
      [36.1948857, 139.4381216],
      [36.1946508, 139.4385367],
      [36.193674, 139.439879],
      [36.1934552, 139.4402106],
      [36.1934365, 139.4402458],
      [36.1930119, 139.4410584],
      [36.1927457, 139.4415724],
      [36.192527, 139.44211],
      [36.1923845, 139.442619],
      [36.1922468, 139.443252],
      [36.1921774, 139.4439133],
      [36.1921511, 139.4443362],
      [36.1921831, 139.4446651],
      [36.1922455, 139.4451716],
      [36.1923712, 139.4459692],
      [36.192439, 139.446233],
      [36.192871, 139.447203],
      [36.1936972, 139.4490486],
      // --- ç¦å·â†’æ˜Ÿå· æ©‹æ¸¡ã—ï¼ˆ2ç‚¹ï¼‰ ---
      [36.185477, 139.450376],
      [36.177257, 139.451702],
      // --- æ˜Ÿå·ï¼ˆè¡Œç”°å¸‚â†’ç†Šè°·å¸‚ä»˜è¿‘, 249ç‚¹ï¼‰ ---
      [36.1690364, 139.4530293],
      [36.169103, 139.452642],
      [36.169124, 139.452521],
      [36.169131, 139.452481],
      [36.169128, 139.452446],
      [36.16911, 139.452243],
      [36.169109, 139.452231],
      [36.169101, 139.452213],
      [36.168797, 139.451544],
      [36.168401, 139.450776],
      [36.167902, 139.449823],
      [36.167364, 139.448798],
      [36.1670162, 139.4481284],
      [36.166942, 139.447946],
      [36.166784, 139.447698],
      [36.166656, 139.447488],
      [36.166412, 139.447019],
      [36.165574, 139.445822],
      [36.165086, 139.445198],
      [36.164399, 139.444252],
      [36.164361, 139.4442031],
      [36.1643301, 139.4441634],
      [36.16421, 139.444009],
      [36.163906, 139.443658],
      [36.163885, 139.44363],
      [36.163571, 139.443216],
      [36.1634951, 139.4430468],
      [36.163379, 139.442838],
      [36.163338, 139.442753],
      [36.163124, 139.442098],
      [36.163037, 139.441841],
      [36.162767, 139.441041],
      [36.1625738, 139.4402242],
      [36.1622866, 139.4392356],
      [36.162038, 139.438899],
      [36.1618909, 139.4387614],
      [36.1617581, 139.4386404],
      [36.161573, 139.438404],
      [36.1613904, 139.438207],
      [36.1608802, 139.4379245],
      [36.1607288, 139.4377513],
      [36.1606374, 139.4376333],
      [36.1605757, 139.43752],
      [36.1604677, 139.4373038],
      [36.1603491, 139.4370301],
      [36.160235, 139.436767],
      [36.1600619, 139.436377],
      [36.1599636, 139.4360399],
      [36.1599508, 139.4357179],
      [36.1599144, 139.4353813],
      [36.1598921, 139.4351584],
      [36.1598388, 139.4348597],
      [36.159773, 139.434584],
      [36.1597234, 139.4343317],
      [36.159671, 139.434091],
      [36.159586, 139.433711],
      [36.1594321, 139.433345],
      [36.1594006, 139.4332725],
      [36.15905, 139.432603],
      [36.158986, 139.432481],
      [36.15894, 139.432396],
      [36.1588964, 139.4323319],
      [36.158825, 139.432213],
      [36.158763, 139.432114],
      [36.158566, 139.4318],
      [36.158321, 139.43143],
      [36.158271, 139.431257],
      [36.158271, 139.431087],
      [36.158294, 139.4309],
      [36.158362, 139.430663],
      [36.158396, 139.430459],
      [36.15841, 139.430196],
      [36.158424, 139.428224],
      [36.158435, 139.427254],
      [36.158441, 139.426797],
      [36.158447, 139.425727],
      [36.1584753, 139.4254213],
      [36.1585045, 139.4251163],
      [36.1585555, 139.4249873],
      [36.158817, 139.4240398],
      [36.1588838, 139.4237242],
      [36.1588655, 139.423548],
      [36.158729, 139.423368],
      [36.158593, 139.423147],
      [36.158072, 139.42246],
      [36.157753, 139.42209],
      [36.157624, 139.421866],
      [36.1575947, 139.421692],
      [36.157504, 139.421457],
      [36.157409, 139.421135],
      [36.157324, 139.421009],
      [36.1570326, 139.42081],
      [36.1569036, 139.4208038],
      [36.1567007, 139.4206888],
      [36.156537, 139.420371],
      [36.156351, 139.419923],
      [36.156017, 139.419014],
      [36.155898, 139.418573],
      [36.1559049, 139.4185224],
      [36.1559584, 139.4184316],
      [36.156099, 139.4181242],
      [36.156167, 139.4179626],
      [36.1561693, 139.417841],
      [36.1560211, 139.4176083],
      [36.156012, 139.417479],
      [36.1561124, 139.4170638],
      [36.1562276, 139.4168441],
      [36.1564234, 139.4167384],
      [36.1565643, 139.4167317],
      [36.156645, 139.416733],
      [36.156728, 139.416763],
      [36.156913, 139.416917],
      [36.157101, 139.417087],
      [36.157221, 139.417134],
      [36.157392, 139.417149],
      [36.157568, 139.417149],
      [36.157669, 139.417174],
      [36.157737, 139.417226],
      [36.157823, 139.417355],
      [36.157937, 139.417543],
      [36.158024, 139.417688],
      [36.158129, 139.41779],
      [36.158246, 139.417849],
      [36.158446, 139.417852],
      [36.158584, 139.417812],
      [36.158695, 139.417752],
      [36.158824, 139.417651],
      [36.158917, 139.417558],
      [36.1592313, 139.4168415],
      [36.159465, 139.416386],
      [36.1598074, 139.4158814],
      [36.1600126, 139.415504],
      [36.1600323, 139.4154029],
      [36.159994, 139.415259],
      [36.159978, 139.415126],
      [36.1600103, 139.4149591],
      [36.1600608, 139.4147569],
      [36.1603439, 139.4143526],
      [36.1603813, 139.4141617],
      [36.1603928, 139.4139943],
      [36.1603731, 139.4138961],
      [36.160311, 139.413772],
      [36.160229, 139.413578],
      [36.159983, 139.413238],
      [36.1598385, 139.4131639],
      [36.1596572, 139.4131242],
      [36.1593468, 139.4131688],
      [36.1590087, 139.4131071],
      [36.1588412, 139.413054],
      [36.158686, 139.4129604],
      [36.1584899, 139.4127763],
      [36.157505, 139.411492],
      [36.157166, 139.411061],
      [36.157012, 139.410851],
      [36.15695, 139.410759],
      [36.156929, 139.410629],
      [36.156944, 139.410515],
      [36.157021, 139.410321],
      [36.157206, 139.409957],
      [36.1575124, 139.4094432],
      [36.1577458, 139.408983],
      [36.157955, 139.4084483],
      [36.15808, 139.408371],
      [36.1582687, 139.408302],
      [36.1584504, 139.4082944],
      [36.1586674, 139.4083197],
      [36.1587815, 139.4083204],
      [36.1589318, 139.4083024],
      [36.1592351, 139.4081592],
      [36.1595813, 139.4079375],
      [36.1597453, 139.4076852],
      [36.1598948, 139.4073327],
      [36.1599955, 139.4070627],
      [36.1601065, 139.4067937],
      [36.1602943, 139.4062103],
      [36.1604675, 139.405745],
      [36.160647, 139.405126],
      [36.1607189, 139.4049935],
      [36.1607649, 139.4047642],
      [36.1607261, 139.4040632],
      [36.1606356, 139.4037391],
      [36.160559, 139.4036444],
      [36.1440034, 139.3822259],
      [36.1439138, 139.3825202],
      [36.1437397, 139.3830946],
      [36.1435445, 139.3837309],
      [36.1434419, 139.3840785],
      [36.1432593, 139.3846789],
      [36.1432212, 139.3848043],
      [36.1425458, 139.3870251],
      [36.1420988, 139.3884951],
      [36.1420607, 139.3886204],
      [36.1416767, 139.3898832],
      [36.1414867, 139.390508],
      [36.1408977, 139.3924587],
      [36.1406961, 139.3929255],
      [36.1405307, 139.3932105],
      [36.1402392, 139.3937286],
      [36.1401612, 139.3938598],
      [36.1400863, 139.3939971],
      [36.1399113, 139.3941461],
      [36.139845, 139.3942056],
      [36.1397707, 139.3942692],
      [36.1397448, 139.3943091],
      [36.1397376, 139.3943301],
      [36.139734, 139.3943487],
      [36.1397344, 139.3944504],
      [36.1397449, 139.3946049],
      [36.1397398, 139.3946589],
      [36.13972, 139.3947025],
      [36.1395941, 139.3948841],
      [36.1395613, 139.3949439],
      [36.1395331, 139.3950211],
      [36.1395125, 139.3950958],
      [36.1394852, 139.395267],
      [36.1394426, 139.3954903],
      [36.1394174, 139.3955968],
      [36.1394096, 139.3956723],
      [36.1393987, 139.3957772],
      [36.1393859, 139.3959002],
      [36.1393717, 139.3960367],
      [36.1393558, 139.3961029],
      [36.1393246, 139.3961764],
      [36.1392141, 139.3963364],
      [36.139196, 139.3963739],
      [36.1391807, 139.3964328],
      [36.1391438, 139.3966888],
      [36.1391241, 139.3968251],
      [36.1391105, 139.3968974],
      [36.1390959, 139.3969468],
      [36.1390434, 139.3970629],
      [36.1390082, 139.3971324],
      [36.1389647, 139.3972249],
      [36.1389191, 139.3973268],
      [36.1388629, 139.3974713],
      [36.1387618, 139.3977463],
      [36.138726, 139.3977854],
      [36.1385907, 139.397884],
      [36.1385165, 139.3979433],
      [36.138414, 139.398059],
      [36.138283, 139.3982498],
      [36.1381839, 139.398444],
      [36.138062, 139.3987449],
      [36.1379708, 139.3989848],
      [36.1379676, 139.3992182],
      [36.138045, 139.399316],
      [36.1381094, 139.3994112],
      [36.138184, 139.39957],
      [36.1382763, 139.3998174],
      // --- å…ƒè’å·å‰åŠï¼ˆç†Šè°·â†’lat36.07ä»˜è¿‘, 596ç‚¹ï¼‰ ---
      [36.1318762, 139.3968776],
      [36.1319043, 139.397145],
      [36.1317552, 139.3972255],
      [36.131721, 139.397314],
      [36.1318257, 139.3975513],
      [36.1318979, 139.3976434],
      [36.131935, 139.3977803],
      [36.1319024, 139.3979898],
      [36.1317221, 139.3981259],
      [36.1316066, 139.3984056],
      [36.131492, 139.3986189],
      [36.1314284, 139.3988412],
      [36.1313912, 139.399095],
      [36.131296, 139.39932],
      [36.1311705, 139.3993859],
      [36.131148, 139.399719],
      [36.131059, 139.39998],
      [36.1310739, 139.4000758],
      [36.1310764, 139.4001606],
      [36.1309353, 139.4002905],
      [36.1310213, 139.4005794],
      [36.1309867, 139.4006993],
      [36.130705, 139.4011932],
      [36.1302605, 139.4017127],
      [36.1301013, 139.401908],
      [36.129969, 139.4019402],
      [36.12971, 139.402068],
      [36.129631, 139.402165],
      [36.129502, 139.402394],
      [36.129332, 139.402804],
      [36.129214, 139.403005],
      [36.129147, 139.403067],
      [36.129079, 139.403095],
      [36.128916, 139.403095],
      [36.1287448, 139.4031291],
      [36.1284723, 139.4031905],
      [36.128341, 139.403213],
      [36.128223, 139.403255],
      [36.128087, 139.403255],
      [36.1278771, 139.4032227],
      [36.1277245, 139.4032504],
      [36.1275945, 139.4032258],
      [36.1274307, 139.4030981],
      [36.127017, 139.402755],
      [36.1269142, 139.4027306],
      [36.1267813, 139.4027571],
      [36.126662, 139.402783],
      [36.126544, 139.402832],
      [36.126499, 139.402857],
      [36.126358, 139.402936],
      [36.126279, 139.402991],
      [36.126082, 139.403179],
      [36.125851, 139.403415],
      [36.125677, 139.40363],
      [36.125615, 139.403727],
      [36.1255193, 139.4040552],
      [36.1253937, 139.4045199],
      [36.1251517, 139.4051916],
      [36.1250727, 139.405454],
      [36.125029, 139.405809],
      [36.125096, 139.406156],
      [36.125096, 139.406531],
      [36.1252013, 139.4067993],
      [36.1252875, 139.4070186],
      [36.1254033, 139.4071535],
      [36.125665, 139.407239],
      [36.125694, 139.407274],
      [36.125716, 139.40735],
      [36.1258302, 139.407559],
      [36.1258455, 139.4076636],
      [36.1259553, 139.4081888],
      [36.1260278, 139.4088363],
      [36.1260537, 139.4092399],
      [36.1259927, 139.4096707],
      [36.1258107, 139.4106383],
      [36.1256903, 139.4111861],
      [36.1255385, 139.4116407],
      [36.1254216, 139.4118274],
      [36.1253303, 139.4119617],
      [36.125238, 139.412028],
      [36.125221, 139.412069],
      [36.124924, 139.412416],
      [36.124325, 139.413118],
      [36.123998, 139.413513],
      [36.123125, 139.414526],
      [36.123008, 139.4147902],
      [36.1229197, 139.4149502],
      [36.1228159, 139.4153183],
      [36.1227095, 139.4159126],
      [36.1226282, 139.4164459],
      [36.1224953, 139.4173138],
      [36.1223889, 139.4178902],
      [36.1223513, 139.4181891],
      [36.1223485, 139.41832],
      [36.1223543, 139.4184443],
      [36.122441, 139.418603],
      [36.1225916, 139.4187355],
      [36.1226669, 139.4188465],
      [36.1227323, 139.4190578],
      [36.1226726, 139.4192796],
      [36.122635, 139.4194843],
      [36.1225561, 139.4197773],
      [36.1224382, 139.4200497],
      [36.122269, 139.420204],
      [36.12219, 139.420287],
      [36.122106, 139.420357],
      [36.121999, 139.420481],
      [36.121858, 139.420606],
      [36.121745, 139.420662],
      [36.1213649, 139.420833],
      [36.121238, 139.420889],
      [36.121078, 139.420927],
      [36.120932, 139.421012],
      [36.120884, 139.42104],
      [36.120709, 139.421064],
      [36.1206264, 139.4210251],
      [36.120493, 139.4209647],
      [36.1202913, 139.4209134],
      [36.1199989, 139.4210705],
      [36.1196527, 139.4212351],
      [36.1193023, 139.421307],
      [36.1191424, 139.421319],
      [36.119095, 139.4213142],
      [36.118827, 139.421266],
      [36.1185303, 139.4211744],
      [36.1183605, 139.4211075],
      [36.1179955, 139.4210549],
      [36.1179288, 139.4210453],
      [36.1179085, 139.4210424],
      [36.1178344, 139.4210502],
      [36.1177747, 139.4210911],
      [36.1175295, 139.4213467],
      [36.1173702, 139.4214073],
      [36.1171796, 139.4215213],
      [36.1170218, 139.4216596],
      [36.1168616, 139.4218286],
      [36.1167657, 139.4219558],
      [36.1165739, 139.4222287],
      [36.1164306, 139.4225469],
      [36.116366, 139.422668],
      [36.116242, 139.423015],
      [36.1161333, 139.4232213],
      [36.1160913, 139.4234384],
      [36.1160953, 139.4241],
      [36.1161373, 139.4243246],
      [36.1161632, 139.4243751],
      [36.1162551, 139.4244856],
      [36.1162915, 139.4246029],
      [36.1163449, 139.4248195],
      [36.1163941, 139.4249123],
      [36.1165014, 139.4250539],
      [36.1165644, 139.4251459],
      [36.1166494, 139.4252953],
      [36.1166952, 139.4253758],
      [36.116803, 139.4254745],
      [36.1169482, 139.4255834],
      [36.1170123, 139.4256593],
      [36.1171465, 139.4259684],
      [36.1172622, 139.4262844],
      [36.1173508, 139.4265135],
      [36.1173722, 139.4265764],
      [36.1174012, 139.4266767],
      [36.1178287, 139.4274567],
      [36.1178965, 139.4275731],
      [36.117949, 139.427637],
      [36.118124, 139.428012],
      [36.118439, 139.42872],
      [36.118518, 139.428907],
      [36.118563, 139.428983],
      [36.118698, 139.429122],
      [36.1190737, 139.4295129],
      [36.1192427, 139.4296792],
      [36.119474, 139.429986],
      [36.1196738, 139.4301057],
      [36.1199013, 139.4303605],
      [36.1200833, 139.4305429],
      [36.1202177, 139.4306073],
      [36.120365, 139.4306421],
      [36.1204971, 139.4306555],
      [36.1207528, 139.4307065],
      [36.1208416, 139.430744],
      [36.1210171, 139.4309559],
      [36.1211938, 139.4312208],
      [36.1212497, 139.4313693],
      [36.1213535, 139.4317219],
      [36.1213735, 139.4318313],
      [36.1214104, 139.4322309],
      [36.1214035, 139.4323505],
      [36.1213734, 139.4325333],
      [36.1212907, 139.4327839],
      [36.1211335, 139.4332598],
      [36.1210515, 139.433386],
      [36.1209885, 139.4334829],
      [36.1207929, 139.4337326],
      [36.1206142, 139.4339055],
      [36.1205283, 139.4339846],
      [36.1204314, 139.4340329],
      [36.1202631, 139.4341168],
      [36.1200202, 139.4342378],
      [36.1195788, 139.4343005],
      [36.119262, 139.4342842],
      [36.118755, 139.4341719],
      [36.118575, 139.4341285],
      [36.1182222, 139.4338849],
      [36.11737, 139.4334022],
      [36.1171683, 139.4332509],
      [36.1170061, 139.4331013],
      [36.1166049, 139.4327129],
      [36.1163319, 139.432425],
      [36.1160669, 139.4321334],
      [36.1158276, 139.431887],
      [36.1156292, 139.431615],
      [36.1154716, 139.4313888],
      [36.1153169, 139.4311669],
      [36.1150262, 139.4307226],
      [36.1146124, 139.4300467],
      [36.1143393, 139.4295827],
      [36.1141595, 139.4293895],
      [36.114056, 139.429344],
      [36.1138648, 139.4292474],
      [36.1136655, 139.429242],
      [36.1134033, 139.4292313],
      [36.1131693, 139.4292742],
      [36.1129027, 139.4293439],
      [36.112673, 139.4294941],
      [36.112608, 139.4295263],
      [36.1120598, 139.4301486],
      [36.111398, 139.430712],
      [36.111285, 139.430851],
      [36.111009, 139.431295],
      [36.11075, 139.431788],
      [36.11073, 139.431817],
      [36.110699, 139.431864],
      [36.110654, 139.431947],
      [36.11066, 139.43201],
      [36.110705, 139.432121],
      [36.110705, 139.432225],
      [36.110682, 139.432371],
      [36.110575, 139.432558],
      [36.110429, 139.432732],
      [36.110322, 139.432829],
      [36.1099247, 139.4332319],
      [36.1097363, 139.4334694],
      [36.1095508, 139.4336932],
      [36.109319, 139.433877],
      [36.108891, 139.4343],
      [36.108699, 139.434578],
      [36.108654, 139.434675],
      [36.108598, 139.434869],
      [36.108536, 139.43523],
      [36.108514, 139.435501],
      [36.10848, 139.435556],
      [36.1082886, 139.4360789],
      [36.10823, 139.436182],
      [36.1080132, 139.4364995],
      [36.107528, 139.437042],
      [36.107393, 139.437201],
      [36.107257, 139.437312],
      [36.107088, 139.437416],
      [36.106886, 139.437555],
      [36.106463, 139.437749],
      [36.105455, 139.438124],
      [36.105342, 139.438173],
      [36.1052898, 139.4382202],
      [36.1052153, 139.4382919],
      [36.1051559, 139.4383704],
      [36.1051018, 139.4384687],
      [36.10507, 139.4385618],
      [36.1049375, 139.4390487],
      [36.1048349, 139.4394379],
      [36.1046996, 139.439864],
      [36.1046526, 139.4400176],
      [36.1046136, 139.4402023],
      [36.1046381, 139.4403404],
      [36.1047241, 139.4405157],
      [36.1048838, 139.4407262],
      [36.1049482, 139.4408353],
      [36.1050426, 139.4409028],
      [36.1051938, 139.4409802],
      [36.1054203, 139.4410163],
      [36.1057478, 139.4410093],
      [36.1060729, 139.4410539],
      [36.1064267, 139.4411262],
      [36.1066395, 139.4411721],
      [36.1067815, 139.4412084],
      [36.1068932, 139.441317],
      [36.106993, 139.4415063],
      [36.1070581, 139.4417412],
      [36.1071026, 139.4420086],
      [36.1072582, 139.4429753],
      [36.1073227, 139.4434686],
      [36.1073097, 139.4437475],
      [36.10726, 139.4439578],
      [36.1071597, 139.4441515],
      [36.1070114, 139.4443481],
      [36.1067643, 139.4445868],
      [36.1064978, 139.444906],
      [36.1063175, 139.4451963],
      [36.1061952, 139.4455971],
      [36.1061861, 139.445944],
      [36.1062291, 139.4461988],
      [36.1063071, 139.4464456],
      [36.1064848, 139.4468184],
      [36.1069204, 139.4476848],
      [36.1071414, 139.4481113],
      [36.1074259, 139.4488042],
      [36.107629, 139.4495114],
      [36.1078587, 139.4508605],
      [36.1079042, 139.4512843],
      [36.1079116, 139.451582],
      [36.107889, 139.4518744],
      [36.1078479, 139.4520593],
      [36.1077882, 139.4522365],
      [36.1076542, 139.4525692],
      [36.1075221, 139.4527722],
      [36.1072535, 139.4531057],
      [36.1069789, 139.4534315],
      [36.1066115, 139.4538981],
      [36.1064306, 139.4543125],
      [36.1063244, 139.4546451],
      [36.1063028, 139.4549321],
      [36.1063242, 139.4553962],
      [36.1063656, 139.455954],
      [36.1063801, 139.456098],
      [36.1063912, 139.4562087],
      [36.1063949, 139.4564538],
      [36.1063743, 139.4567024],
      [36.1062637, 139.4578423],
      [36.1061863, 139.4584332],
      [36.1061315, 139.4586886],
      [36.1060551, 139.4589424],
      [36.1059289, 139.4592853],
      [36.1057296, 139.4597172],
      [36.105514, 139.460267],
      [36.1051844, 139.4610416],
      [36.104957, 139.4613973],
      [36.1047908, 139.4615489],
      [36.1045192, 139.4617628],
      [36.1044055, 139.4618332],
      [36.103951, 139.462082],
      [36.103405, 139.462301],
      [36.1031734, 139.4623069],
      [36.1029444, 139.4622926],
      [36.102673, 139.4621912],
      [36.102216, 139.462024],
      [36.101958, 139.461917],
      [36.101605, 139.461798],
      [36.101347, 139.46179],
      [36.10104, 139.461901],
      [36.100609, 139.462113],
      [36.099781, 139.462652],
      [36.099367, 139.462917],
      [36.099068, 139.46325],
      [36.09876, 139.463711],
      [36.0983017, 139.4645559],
      [36.098228, 139.4646176],
      [36.0980958, 139.4646437],
      [36.0977936, 139.4647059],
      [36.097489, 139.464801],
      [36.0973852, 139.4648357],
      [36.0968846, 139.464805],
      [36.0967074, 139.4648166],
      [36.0965272, 139.4648383],
      [36.096347, 139.464878],
      [36.096075, 139.464932],
      [36.0958841, 139.4650278],
      [36.0953902, 139.4653746],
      [36.0951325, 139.4655131],
      [36.0948996, 139.4655964],
      [36.094735, 139.465649],
      [36.0946014, 139.465681],
      [36.0944113, 139.4657077],
      [36.0941463, 139.4656991],
      [36.093932, 139.4656947],
      [36.0935615, 139.4658707],
      [36.0932385, 139.4660917],
      [36.0929146, 139.4663556],
      [36.0926981, 139.4665509],
      [36.0925177, 139.466794],
      [36.0924195, 139.4671914],
      [36.092343, 139.4675092],
      [36.0923499, 139.4677145],
      [36.0923612, 139.4678933],
      [36.0925401, 139.4685107],
      [36.0926934, 139.469169],
      [36.0929477, 139.4699628],
      [36.0930543, 139.4702743],
      [36.09312, 139.470625],
      [36.0931332, 139.4709915],
      [36.0930812, 139.4715264],
      [36.0930552, 139.471886],
      [36.0930673, 139.4720643],
      [36.093118, 139.4722395],
      [36.0931895, 139.472357],
      [36.0935059, 139.4726335],
      [36.0937324, 139.4729016],
      [36.0947059, 139.4744879],
      [36.0949159, 139.4746646],
      [36.0953136, 139.4748799],
      [36.0959889, 139.475247],
      [36.0962775, 139.4754141],
      [36.0981748, 139.4760238],
      [36.0985269, 139.4761455],
      [36.0992665, 139.4764011],
      [36.0994206, 139.4764775],
      [36.0995287, 139.476568],
      [36.0996759, 139.4767101],
      [36.0998123, 139.4768996],
      [36.0998704, 139.477069],
      [36.0999522, 139.4773367],
      [36.0999705, 139.4776118],
      [36.0999993, 139.4780471],
      [36.099805, 139.4783149],
      [36.0997072, 139.4784798],
      [36.0995683, 139.4786384],
      [36.0993828, 139.4788494],
      [36.0992946, 139.4789242],
      [36.098348, 139.47966],
      [36.0980933, 139.479941],
      [36.0978981, 139.4803612],
      [36.0978383, 139.4804798],
      [36.0977462, 139.4814275],
      [36.097744, 139.4814422],
      [36.0977467, 139.4819845],
      [36.0977389, 139.4820749],
      [36.0976481, 139.482514],
      [36.0973547, 139.4828029],
      [36.0965714, 139.4831301],
      [36.096181, 139.483289],
      [36.094931, 139.484547],
      [36.094618, 139.484814],
      [36.094331, 139.485032],
      [36.093927, 139.485216],
      [36.093609, 139.485281],
      [36.092892, 139.485382],
      [36.092727, 139.485554],
      [36.092592, 139.485873],
      [36.092227, 139.486842],
      [36.091955, 139.487222],
      [36.0915566, 139.4877753],
      [36.0914018, 139.4880644],
      [36.0912801, 139.4884823],
      [36.091044, 139.4892382],
      [36.090806, 139.489924],
      [36.0908504, 139.4906866],
      [36.0908788, 139.4911704],
      [36.0908035, 139.4917117],
      [36.0905455, 139.4923071],
      [36.0902709, 139.4928708],
      [36.0901967, 139.4932496],
      [36.0902011, 139.4935169],
      [36.0903484, 139.4941409],
      [36.0904767, 139.49458],
      [36.0904824, 139.4947824],
      [36.0904207, 139.4953702],
      [36.0901885, 139.4957351],
      [36.0899636, 139.4959823],
      [36.0897928, 139.4961467],
      [36.0894295, 139.4963658],
      [36.088885, 139.496642],
      [36.0886723, 139.4967958],
      [36.088454, 139.496974],
      [36.0880881, 139.497238],
      [36.0878066, 139.4974173],
      [36.0876779, 139.4975656],
      [36.0875906, 139.4976898],
      [36.0875233, 139.4978737],
      [36.0874834, 139.4980443],
      [36.0874793, 139.4982317],
      [36.0875085, 139.4985311],
      [36.0875673, 139.4989363],
      [36.0876055, 139.4992682],
      [36.0876068, 139.4994696],
      [36.0875858, 139.4997873],
      [36.0875372, 139.5000058],
      [36.0874242, 139.5001397],
      [36.0872686, 139.5002257],
      [36.0868622, 139.5002768],
      [36.086513, 139.500275],
      [36.086197, 139.5003],
      [36.086042, 139.500348],
      [36.08588, 139.500432],
      [36.0858, 139.500491],
      [36.085668, 139.500587],
      [36.085491, 139.500737],
      [36.085, 139.50115],
      [36.084646, 139.501445],
      [36.084441, 139.501595],
      [36.084434, 139.501601],
      [36.0842, 139.501772],
      [36.083852, 139.502026],
      [36.083764, 139.502084],
      [36.083333, 139.502365],
      [36.083108, 139.502519],
      [36.082799, 139.502731],
      [36.082473, 139.502927],
      [36.082425, 139.502955],
      [36.082371, 139.503005],
      [36.082208, 139.503156],
      [36.082031, 139.503375],
      [36.081917, 139.503517],
      [36.081882, 139.503601],
      [36.081721, 139.503988],
      [36.081494, 139.504576],
      [36.081472, 139.504613],
      [36.08139, 139.504747],
      [36.081367, 139.504776],
      [36.081179, 139.505007],
      [36.080855, 139.505279],
      [36.080776, 139.505346],
      [36.080517, 139.505622],
      [36.080501, 139.505644],
      [36.080312, 139.505905],
      [36.080311, 139.505908],
      [36.080293, 139.505943],
      [36.080078, 139.506369],
      [36.079959, 139.506668],
      [36.07985, 139.506941],
      [36.079716, 139.507238],
      [36.079667, 139.507346],
      [36.079487, 139.507648],
      [36.078947, 139.508544],
      [36.07881, 139.508947],
      [36.078777, 139.509043],
      [36.078631, 139.509464],
      [36.078614, 139.509513],
      [36.078481, 139.509778],
      [36.078069, 139.510303],
      [36.077594, 139.510889],
      [36.077411, 139.511155],
      [36.077033, 139.511705],
      [36.07684, 139.511957],
      [36.076794, 139.512017],
      [36.076707, 139.512068],
      [36.076644, 139.512105],
      [36.076202, 139.512362],
      [36.075197, 139.512767],
      [36.0749624, 139.5130007],
      [36.0748669, 139.5131698],
      [36.0747595, 139.51356],
      [36.074677, 139.5140745],
      [36.0745583, 139.5143742],
      [36.074383, 139.514557],
      [36.074028, 139.514806],
      [36.073667, 139.514974],
      [36.073255, 139.515156],
      [36.072901, 139.5152881],
      [36.072523, 139.515483],
      [36.072316, 139.515595],
      [36.071984, 139.515828],
      [36.07168, 139.516065],
      [36.071576, 139.516172],
      [36.071525, 139.516242],
      [36.07148, 139.51637],
      [36.071452, 139.516517],
      [36.071429, 139.516686],
      [36.071436, 139.516891],
      [36.071458, 139.517169],
      [36.071509, 139.518016],
      [36.071503, 139.518157],
      [36.071464, 139.518349],
      [36.07141, 139.518519],
      [36.071151, 139.519404],
      [36.07111, 139.519609],
      [36.0711, 139.519836],
      [36.071116, 139.519999],
      [36.071161, 139.520162],
      [36.071241, 139.52035],
      [36.07148, 139.520798],
      [36.07156, 139.520945],
      [36.071602, 139.52107],
      [36.071621, 139.521226],
      [36.071627, 139.521306],
      [36.071592, 139.521533],
      [36.071484, 139.522076],
      [36.071445, 139.522313],
      [36.071352, 139.522857],
      [36.071183, 139.5238],
      [36.071116, 139.524036],
      [36.070972, 139.524436],
      [36.070761, 139.525008],
      [36.070758, 139.525021],
      [36.070688, 139.525283],
      [36.070643, 139.525571],
      [36.070627, 139.525906],
      [36.07064, 139.526191],
      [36.070691, 139.526409],
      [36.070787, 139.526635],
      [36.071097, 139.527255],
      [36.071237, 139.527559],
      [36.071288, 139.527722],
      [36.071288, 139.527885],
      [36.071214, 139.528094],
      [36.0711047, 139.5284628],
      [36.0701731, 139.5298094],
      [36.0700085, 139.5299542],
      // --- é‡é€šå·lat36.06-36.07å¸¯ï¼ˆ39ç‚¹ï¼‰ ---
      [36.0698415, 139.5613949],
      [36.06964, 139.5616454],
      [36.069244, 139.562113],
      [36.0691456, 139.5622288],
      [36.068969, 139.5625033],
      [36.068699, 139.563018],
      [36.068065, 139.564463],
      [36.0674161, 139.5661102],
      [36.0672676, 139.5664668],
      [36.066488, 139.568298],
      [36.06638, 139.568529],
      [36.066253, 139.568761],
      [36.065717, 139.569657],
      [36.065451, 139.570114],
      [36.065328, 139.570481],
      [36.0652892, 139.5706275],
      [36.0652604, 139.5708686],
      [36.0649069, 139.5732072],
      [36.0648344, 139.5735078],
      [36.064782, 139.573674],
      [36.06469, 139.573945],
      [36.064478, 139.574291],
      [36.0638391, 139.5752956],
      [36.0636928, 139.575566],
      [36.0635706, 139.5758348],
      [36.0634949, 139.5760856],
      [36.063239, 139.57713],
      [36.0625932, 139.5797552],
      [36.0624938, 139.5800847],
      [36.0623749, 139.580431],
      [36.0622461, 139.5807481],
      [36.061509, 139.582136],
      [36.061311, 139.582567],
      [36.060821, 139.583848],
      [36.060695, 139.584127],
      [36.060572, 139.584308],
      [36.060446, 139.584427],
      [36.060298, 139.584532],
      [36.060048, 139.584617],
      // --- é‡é€šå·â†’å‚™å‰å‰å €å· æ©‹æ¸¡ã—ï¼ˆ1ç‚¹ï¼‰ ---
      [36.064465, 139.608693],
      // --- å‚™å‰å‰å €å·ï¼ˆ2ç‚¹ï¼‰ ---
      [36.068883, 139.632768],
      [36.056553, 139.652281],
      // --- å‚™å‰å‰å €å·â†’è“®ãƒ¶åŸå· æ©‹æ¸¡ã—ï¼ˆ1ç‚¹ï¼‰ ---
      [36.063287, 139.65366],
      // --- è“®ãƒ¶åŸå·ï¼ˆ89ç‚¹ï¼‰ ---
      [36.070021, 139.655039],
      [36.06988, 139.655351],
      [36.069857, 139.65542],
      [36.069829, 139.655462],
      [36.069672, 139.655829],
      [36.069542, 139.656141],
      [36.069086, 139.657181],
      [36.068748, 139.657979],
      [36.068725, 139.658007],
      [36.068714, 139.658062],
      [36.068506, 139.658534],
      [36.068458, 139.658912],
      [36.068207, 139.659837],
      [36.068139, 139.660211],
      [36.068027, 139.660759],
      [36.068, 139.661102],
      [36.067892, 139.661598],
      [36.067765, 139.661898],
      [36.067683, 139.66207],
      [36.067601, 139.662201],
      [36.067322, 139.662465],
      [36.067254, 139.662581],
      [36.067037, 139.662808],
      [36.06689, 139.662998],
      [36.066746, 139.663201],
      [36.066614, 139.663359],
      [36.065502, 139.665604],
      [36.06517, 139.665803],
      [36.064334, 139.666405],
      [36.064064, 139.66658],
      [36.064057, 139.666585],
      [36.06392, 139.666675],
      [36.063729, 139.666829],
      [36.063672, 139.66688],
      [36.063602, 139.666938],
      [36.06337, 139.667137],
      [36.063341, 139.667161],
      [36.063334, 139.667167],
      [36.062823, 139.667612],
      [36.06244, 139.668045],
      [36.062135, 139.668254],
      [36.061395, 139.668681],
      [36.061231, 139.669121],
      [36.060702, 139.670295],
      [36.060406, 139.670927],
      [36.060365, 139.67102],
      [36.059886, 139.672138],
      [36.05924, 139.673525],
      [36.059215, 139.673596],
      [36.059154, 139.673814],
      [36.058829, 139.674728],
      [36.058727, 139.675012],
      [36.058696, 139.67519],
      [36.058208, 139.67607],
      [36.057762, 139.676846],
      [36.057709, 139.676954],
      [36.057665, 139.677019],
      [36.057459, 139.677291],
      [36.05747, 139.67732],
      [36.057565, 139.677394],
      [36.057712, 139.677488],
      [36.057871, 139.677642],
      [36.057955, 139.677747],
      [36.058223, 139.67804],
      [36.058265, 139.678085],
      [36.058315, 139.678124],
      [36.058383, 139.6782],
      [36.058448, 139.678309],
      [36.058597, 139.67852],
      [36.058681, 139.678631],
      [36.05875, 139.678722],
      [36.059235, 139.679308],
      [36.059294, 139.67938],
      [36.059338, 139.679436],
      [36.059595, 139.679745],
      [36.059669, 139.679935],
      [36.059722, 139.680043],
      [36.059855, 139.680416],
      [36.060013, 139.6808],
      [36.060019, 139.680827],
      [36.060026, 139.680876],
      [36.06, 139.681219],
      [36.059987, 139.681346],
      [36.059948, 139.681854],
      [36.05992, 139.682193],
      [36.059866, 139.682627],
      [36.059845, 139.682788],
      [36.059784, 139.683262],
      [36.059769, 139.683388],
      // --- å¤§è½å¤åˆ©æ ¹å·åŒ—ç«¯ï¼ˆæ¥ç¶šç‚¹ãƒ»å›ºå®šï¼‰ ---
      [36.0578, 139.6989]
    ];
    addPolylineWithOutline(coords,
      { color: COLOR_MAIN, weight: 4, opacity: 0.95, pane: "paneRivers" },
      "<b>æ—§åˆ©æ ¹å·æœ¬æµï¼ˆæ¨å®šï¼‰ä¸Šæµæ¥ç¶š</b><br/>ç¾¤é¦¬æ–¹é¢â†’ä¸­å·ãƒ»ç¶¾ç€¬å·ç­‹ï¼ˆ1590å¹´é ƒï¼‰ã€‚<br/>åˆ©æ ¹å·æ±é·äº‹æ¥­ï¼ˆ1594ã€œ1654å¹´ï¼‰ä»¥å‰ã®æ—§æœ¬æµç­‹ã€‚",
      lyrNakaAyase, "triple");
  }

  function addMotoArakawaUpstreamExt() {
    // æ—§è’å·ï¼ˆå…ƒè’å·ï¼‰ã®ä¸Šæµå´å»¶ä¼¸ â€” ç§©çˆ¶æ–¹é¢ã‹ã‚‰ã®æ—§è’å·ã¨ã®æ¥ç¶š
    // 1590å¹´é ƒã€è’å·ã¯ç§©çˆ¶ã‹ã‚‰æ±ã¸æµã‚Œã€ç¾åœ¨ã®å…ƒè’å·æ–¹é¢ã¸æµã‚Œã¦ã„ãŸï¼ˆè¥¿é·äº‹æ¥­ä»¥å‰ï¼‰
    const coords = [
      [35.9818, 139.0563],  // ç§©çˆ¶å¸‚å—è¥¿éƒ¨ï¼ˆæ–°è¥¿ç«¯ï¼‰
      [35.9919, 139.0706],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0030, 139.0716],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0127, 139.0779],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0242, 139.0899],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0317, 139.0893],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0473, 139.0987],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0613, 139.0932],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0705, 139.0877],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0809, 139.0993],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0857, 139.1179],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.0934, 139.1168],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.1062, 139.1132],  // ç§©çˆ¶ä¸Šæµéƒ¨
      [36.1143, 139.1188],  // ç§©çˆ¶ä¸Šæµéƒ¨ï¼ˆå»¶ä¼¸æ¥ç¶šï¼‰
      [36.1231, 139.1136],  // ç§©çˆ¶æ–¹é¢ï¼ˆå¯„å±…ã€œé•·ç€æ–¹å‘ï¼‰æœ€è¥¿ç«¯
      [36.1296, 139.1213],  // ä¸Šæµéƒ¨
      [36.1343, 139.1325],  // ä¸Šæµéƒ¨ï¼ˆåµå±±ä»˜è¿‘ï¼‰
      [36.1333, 139.1483],  // ä¸Šæµéƒ¨
      [36.1339, 139.1559],  // ä¸Šæµéƒ¨
      [36.1307, 139.1578],  // ä¸Šæµéƒ¨
      [36.1165, 139.1699],  // å°å·ç”ºè¥¿éƒ¨
      [36.1136, 139.1818],  // åµå±±ã€œå°å·
      [36.1093, 139.1939],  // å°å·ç”ºä»˜è¿‘
      [36.1204, 139.2131],  // å¯„å±…ã€œå°å·æ–¹é¢
      [36.1184, 139.2474],  // å¯„å±…ç”ºä»˜è¿‘
      [36.1349, 139.2736],  // æ·±è°·ã€œå¯„å±…æ–¹é¢
      [36.1379, 139.3057],  // æ·±è°·å¸‚ä»˜è¿‘
      [36.1372, 139.3442],  // ç†Šè°·ã€œæ·±è°·æ–¹é¢
      [36.1317, 139.3958],  // æ¥ç¶šç‚¹ï¼ˆOSMå…ƒè’å·è¥¿ç«¯ï¼‰
    ];
    addPolylineWithOutline(coords,
      { color: COLOR_MAIN, weight: 5, opacity: 0.95, pane: "paneRivers" },
      "<b>æ—§è’å·ï¼ˆæ¨å®šï¼‰ä¸Šæµæ¥ç¶š</b><br/>ç§©çˆ¶æ–¹é¢â†’å…ƒè’å·ç­‹ï¼ˆ1590å¹´é ƒï¼‰ã€‚<br/>è’å·è¥¿é·äº‹æ¥­ä»¥å‰ã®æ—§è’å·ã®æµè·¯ã€‚",
      lyrMotoArakawa, "triple");
  }

  // ----- Ishida Tsutsumi (schematic retrace) -----
  const ishidaAnchors = [
    [36.158155, 139.46755],     // ç™½å·æˆ¸
    [36.1472884, 139.4683494],  // æ±è¡Œç”°é§…ä»˜è¿‘
    [36.129312, 139.47849],     // ä¸¸å¢“å±±å¤å¢³
    [36.11033, 139.474221],     // å ¤æ ¹
    [36.119226, 139.465552],    // ä¸‹å¿
    [36.127361, 139.437584],    // æ£šç”°
    [36.127688, 139.401143]     // æ±ç«¹é™¢ï¼ˆä¹…ä¸‹å´ï¼‰
  ];

  function catmullRomSpline(points, segments) {
    const out = [];
    const seg = Math.max(10, segments || 28);
    for (let i = 0; i < points.length - 1; i++) {
      const p0 = points[i - 1] || points[i];
      const p1 = points[i];
      const p2 = points[i + 1];
      const p3 = points[i + 2] || p2;
      for (let j = 0; j < seg; j++) {
        const t = j / seg, t2 = t*t, t3 = t2*t;
        const lat = 0.5 * ((2*p1[0]) + (-p0[0]+p2[0])*t + (2*p0[0]-5*p1[0]+4*p2[0]-p3[0])*t2 + (-p0[0]+3*p1[0]-3*p2[0]+p3[0])*t3);
        const lon = 0.5 * ((2*p1[1]) + (-p0[1]+p2[1])*t + (2*p0[1]-5*p1[1]+4*p2[1]-p3[1])*t2 + (-p0[1]+3*p1[1]-3*p2[1]+p3[1])*t3);
        out.push([lat, lon]);
      }
    }
    out.push(points[points.length - 1]);
    return out;
  }

  const ishidaPts = catmullRomSpline(ishidaAnchors, 30);
  const ishidaLine = L.polyline(ishidaPts, {
    color: COLOR_ISHIDA, weight: 4, opacity: 0.85, dashArray: "10 6", pane: "paneIshida"
  }).bindPopup("<b>çŸ³ç”°å ¤ï¼ˆæ¨å®šï¼‰</b><br/>å›½äº¤çœã€æ¨å®šå›³ã€ã®åœ°åã‚¢ãƒ³ã‚«ãƒ¼ã‚’æ‰‹ãŒã‹ã‚Šã«ã—ãŸæ¦‚ç•¥ç·šã€‚<br/><span style='font-size:12px;'>â€»æ¨¡å¼å›³ãƒ™ãƒ¼ã‚¹ãªã®ã§ã€ç¾åœ°æ¸¬é‡ãƒ©ã‚¤ãƒ³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</span>");
  lyrIshidaEst.addLayer(ishidaLine);
  map.addLayer(lyrIshidaEst);

  // ----- Key sites pins -----
  function makePin(latlng, label, emoji, color) {
    const html = `<div class="pin"><div class="pin-dot" style="background:${color}">${emoji}</div><div class="pin-text">${label}</div></div>`;
    return L.marker(latlng, {
      icon: L.divIcon({ className: "", html, iconSize: [1,1], iconAnchor: [0, 0] }),
      pane: "paneLocal"
    });
  }

  const pinOshi = makePin([36.137974, 139.453445], "å¿åŸï¼ˆç¾ãƒ»è¡Œç”°å¸‚éƒ·åœŸåšç‰©é¤¨ï¼‰", "ğŸ¯", "#2b8cbe")
    .bindPopup("<b>å¿åŸï¼ˆãŠã—ã˜ã‚‡ã†ï¼‰</b><br/>ç¾åœ¨ã®å¿åŸå€ï¼ˆè¡Œç”°å¸‚éƒ·åœŸåšç‰©é¤¨ãƒ»å¾¡ä¸‰éšæ«“ï¼‰ã€‚");
  const pinMaruhaka = makePin([36.129312, 139.478490], "çŸ³ç”°ä¸‰æˆæœ¬é™£ï¼ˆä¼ï¼‰ï¼šä¸¸å¢“å±±å¤å¢³", "â›º", "#e34a33")
    .bindPopup("<b>ä¸¸å¢“å±±å¤å¢³</b><br/>å¿åŸãŒè¦‹ãˆã‚‹å ´æ‰€ã¨ã—ã¦ã€çŸ³ç”°ä¸‰æˆãŒé™£ã‚’å¼µã£ãŸã¨ã„ã†ä¼æ‰¿ãŒã‚ã‚Šã¾ã™ã€‚");

  lyrKeySites.addLayer(pinOshi);
  lyrKeySites.addLayer(pinMaruhaka);
  map.addLayer(lyrKeySites);

  // ----- Overpass loader -----
  async function overpassFetch(query) {
    const url = "https://overpass-api.de/api/interpreter";
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8" },
      body: "data=" + encodeURIComponent(query)
    });
    if (!res.ok) throw new Error("Overpass HTTP " + res.status);
    return await res.json();
  }

  function escRe(s) { return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

  async function loadRiversWide() {
    clearAll();
    statusEl.textContent = "æ²³å·ç·šã‚’èª­ã¿è¾¼ã¿ä¸­â€¦ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿â†’ç„¡ã‘ã‚Œã°Overpassï¼‰";

    const s = 35.55, w = 139.20, n = 36.45, e = 140.05;

    const exactRegex = CORE_EXACT_NAMES.map(escRe).join("|");
    const localFuzzy = "(å¿å·|æ˜Ÿå·|æ­¦è”µæ°´è·¯|è¦‹æ²¼ä»£ç”¨æ°´|å’Œç”°å‰é‡å·|å¸‚é‡å·|å…¥é–“å·|è’å·|éš…ç”°å·)";

    const q = `
      [out:json][timeout:60];
      (
        way["waterway"~"river|stream|canal|ditch|drain"]["name"~"^(${exactRegex})$"](${s},${w},${n},${e});
        relation["waterway"~"river|stream|canal|ditch|drain"]["name"~"^(${exactRegex})$"](${s},${w},${n},${e});
        way["waterway"~"river|stream|canal|ditch|drain"]["name"~"${localFuzzy}"](${s},${w},${n},${e});
        relation["waterway"~"river|stream|canal|ditch|drain"]["name"~"${localFuzzy}"](${s},${w},${n},${e});
      );
      (._;>;);
      out body geom;
    `;

    try {
      let data = null;
      let source = "";
      const localUrl = "./data/rivers_wide_overpass.json";
      try {
        const r = await fetch(localUrl, { cache: "force-cache" });
        if (r.ok) {
          data = await r.json();
          source = "local";
        }
      } catch (e) { /* ignore */ }

      if (!data) {
        data = await overpassFetch(q);
        source = "overpass";
      }

      const elements = (data && data.elements) ? data.elements : [];
      const relWayNames = buildWayNameFromRelations(elements);
      const ways = elements.filter(el => el.type === "way" && el.geometry && el.tags && el.tags.waterway);

      const { oshikawaIds } = computeOshikawaComponent(ways, relWayNames);

      let drawn = 0;
      ways.forEach(wy => {
        const ns = getNameSet(wy, relWayNames);
        if (!ns || ns.size === 0) return;

        // only draw ways that match our interest list
        const relevant = Array.from(ns).some(nm =>
          CORE_EXACT_NAMES.includes(nm) ||
          nm.includes("å¿å·") || nm.includes("æ˜Ÿå·") ||
          nm.includes("æ­¦è”µæ°´è·¯") || nm.includes("è¦‹æ²¼ä»£ç”¨æ°´") ||
          nm.includes("å’Œç”°å‰é‡å·") || nm.includes("å¸‚é‡å·") ||
          nm.includes("å…¥é–“å·") || nm.includes("è’å·") || nm.includes("éš…ç”°å·")
        );
        if (!relevant) return;

        drawWayByNameSet(wy, ns, oshikawaIds);
        drawn += 1;
      });

      // build filtered visible layers to avoid é‡åï¼ˆè’å·/å…¥é–“å·ï¼‰
      buildIrumaVisible();
      buildArakawaLink();

      // build dashed pre-route after visible layers exist
      buildIrumaPreRoute();

      // ä¸Šæµæ¥ç¶šï¼ˆæ‰‹æãæ¨å®šãƒ©ã‚¤ãƒ³ï¼‰
      addNakaAyaseUpstreamExt();
      addMotoArakawaUpstreamExt();

      // apply default ON/OFF (ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š)
      applyDefaultLayers();

      statusEl.textContent = `èª­ã¿è¾¼ã¿å®Œäº† âœ… OSMç·šåˆ†ï¼ˆå€™è£œï¼‰:${ways.length} / æç”»:${drawn}ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§åç§°ï¼‰ï¼ˆãƒ‡ãƒ¼ã‚¿å…ƒ: ${source === "local" ? "ãƒ­ãƒ¼ã‚«ãƒ«" : "Overpass"}ï¼‰`;
    } catch (err) {
      console.error(err);
      statusEl.textContent = "èª­ã¿è¾¼ã¿å¤±æ•— âš ï¸ OverpassãŒæ··é›‘ã—ã¦ã„ã‚‹ã‹ã‚‚ã€‚å°‘ã—å¾…ã£ã¦ã€Œå†èª­ã¿è¾¼ã¿ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
    }
  }

  loadRiversWide();
</script>
</body>
</html>
